import{c8 as L,be as U,dx as $,aY as D,Q as E,a2 as z,f as x,U as K,T as q,a5 as j,n as S,aA as H,w as k,X as G,V as Q,Z as M,a1 as X,ax as Y,b0 as T,ab as w,y as Z,a6 as J,E as B,a7 as W,a8 as F,L as ee,a9 as _,R as N,p as te,u as ae,j as se,m as oe,a as e,C as ne,F as re,A as le,c3 as ie,c$ as ue,N as y,c6 as ce,d as de,b,M as pe,r as fe,bo as me,dy as he,P as ve}from"./index-8eac1ff4.js";import{D as ge}from"./delete-confirm-bdba8da5.js";import{R as ye}from"./relative-time-8690a9cd.js";import{u as be}from"./use-table-7eba66f5.js";import{H as Pe}from"./rounded-button-b07f86c3.js";import{c as we,a as Ne}from"./Checkbox-2ecdd3a4.js";import{t as Me,b as xe}from"./Select-e56a7f39.js";import{N as je,a as Ce}from"./ListItem-2f4dd6c6.js";import{a as Re,N as Se}from"./Icon-2092b1d2.js";import{N as Te}from"./ButtonGroup-e6358c6c.js";import{N as O}from"./Avatar-e2cbaebd.js";import"./Tag-f56d7815.js";import"./prop-46b62c35.js";import"./Forward-6182c0eb.js";function _e(t){const{boxShadow2:s}=t;return{menuBoxShadow:s}}const Oe=L({name:"Popselect",common:U,peers:{Popover:$,InternalSelectMenu:D},self:_e});var V=Oe;const I=E("n-popselect");var Ae=z("popselect-menu",`
 box-shadow: var(--n-menu-box-shadow);
`);const C={multiple:Boolean,value:{type:[String,Number,Array],default:null},cancelable:Boolean,options:{type:Array,default:()=>[]},size:{type:String,default:"medium"},scrollable:Boolean,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onMouseenter:Function,onMouseleave:Function,renderLabel:Function,onChange:[Function,Array]},A=X(C);var ke=x({name:"PopselectPanel",props:C,setup(t){const s=K(I),{mergedClsPrefixRef:n,inlineThemeDisabled:u}=q(t),m=j("Popselect","-pop-select",Ae,V,s.props,n),c=S(()=>H(t.options,Me));function l(o,p){const{onUpdateValue:d,"onUpdate:value":v,onChange:g}=t;d&&w(d,o,p),v&&w(v,o,p),g&&w(g,o,p)}function i(o){a(o.key)}function r(o){Y(o,"action")||o.preventDefault()}function a(o){const{value:{getNode:p}}=c;if(t.multiple)if(Array.isArray(t.value)){const d=[],v=[];let g=!0;t.value.forEach(R=>{if(R===o){g=!1;return}const P=p(R);P&&(d.push(P.key),v.push(P.rawNode))}),g&&(d.push(o),v.push(p(o).rawNode)),l(d,v)}else{const d=p(o);d&&l([o],[d.rawNode])}else if(t.value===o&&t.cancelable)l(null,null);else{const d=p(o);d&&l(o,d.rawNode),s.setShow(!1)}T(()=>{s.syncPosition()})}k(G(t,"options"),()=>{T(()=>{s.syncPosition()})});const f=S(()=>{const{self:{menuBoxShadow:o}}=m.value;return{"--n-menu-box-shadow":o}}),h=u?Q("select",void 0,f,s.props):void 0;return{mergedTheme:s.mergedThemeRef,mergedClsPrefix:n,treeMate:c,handleToggle:i,handleMenuMousedown:r,cssVars:u?void 0:f,themeClass:h?.themeClass,onRender:h?.onRender}},render(){var t;return(t=this.onRender)===null||t===void 0||t.call(this),M(xe,{clsPrefix:this.mergedClsPrefix,focusable:!0,class:[`${this.mergedClsPrefix}-popselect-menu`,this.themeClass],style:this.cssVars,theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,multiple:this.multiple,treeMate:this.treeMate,size:this.size,value:this.value,virtualScroll:!1,scrollable:this.scrollable,renderLabel:this.renderLabel,onToggle:this.handleToggle,onMouseenter:this.onMouseenter,onMouseleave:this.onMouseenter,onMousedown:this.handleMenuMousedown},{action:()=>{var s,n;return((n=(s=this.$slots).action)===null||n===void 0?void 0:n.call(s))||[]},empty:()=>{var s,n;return((n=(s=this.$slots).empty)===null||n===void 0?void 0:n.call(s))||[]}})}});const Be=Object.assign(Object.assign(Object.assign(Object.assign({},j.props),F(_,["showArrow","arrow"])),{placement:Object.assign(Object.assign({},_.placement),{default:"bottom"}),trigger:{type:String,default:"hover"}}),C);var Fe=x({name:"Popselect",props:Be,__popover__:!0,setup(t){const s=j("Popselect","-popselect",void 0,V,t),n=Z(null);function u(){var l;(l=n.value)===null||l===void 0||l.syncPosition()}function m(l){var i;(i=n.value)===null||i===void 0||i.setShow(l)}return J(I,{props:t,mergedThemeRef:s,syncPosition:u,setShow:m}),Object.assign(Object.assign({},{syncPosition:u,setShow:m}),{popoverInstRef:n,mergedTheme:s})},render(){const{mergedTheme:t}=this,s={theme:t.peers.Popover,themeOverrides:t.peerOverrides.Popover,builtinThemeOverrides:{padding:"0"},ref:"popoverInstRef",internalRenderBody:(n,u,m,c,l)=>M(ke,Object.assign({},B(this.$attrs,{class:n,style:m}),W(this.$props,A),{ref:we(u),onMouseenter:c,onMouseleave:l}),{action:()=>{var i,r;return(r=(i=this.$slots).action)===null||r===void 0?void 0:r.call(i)},empty:()=>{var i,r;return(r=(i=this.$slots).empty)===null||r===void 0?void 0:r.call(i)}})};return M(ee,Object.assign({},F(this.$props,A),s),{trigger:()=>{var n,u;return(u=(n=this.$slots).default)===null||u===void 0?void 0:u.call(n)}})}});function Ve(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!ve(t)}const Ze=x({setup(){const{data:t,pager:s,sortProps:n,fetchDataFn:u,loading:m}=be((a,f)=>async(h=i.query.page||1,o=30)=>{const p=await N.api.projects.get({params:{page:h,size:o}});a.value=p.data,f.value=p.pagination}),c=te(new Set),l=ae(),i=se(),r=u;return k(()=>i.query.page,async a=>{await r(a)}),oe(async()=>{await r()}),()=>e(ne,null,{actions:()=>e(re,null,[e(ge,{checkedRowKeys:c,onDelete:async()=>{await Promise.all(Array.from(c.values()).map(a=>N.api.projects(a).delete())),c.clear(),r()}},null),e(Pe,{to:"/projects/edit",icon:e(le,null,null)},null)]),default:()=>e(ie,{show:m.value},{default:()=>[e(je,{bordered:!1,class:"min-h-[300px] bg-transparent"},{footer(){return e("div",{class:"flex justify-end"},[e(Re,{itemCount:s.value.total,pageCount:s.value.totalPage,page:s.value.currentPage,pageSize:s.value.size,onUpdatePage:a=>{r(a)}},null)])},default(){return t.value.map(a=>e(Ce,{key:a.id},{prefix(){return e(Ne,{class:"mt-4",checked:c.has(a.id),onUpdateChecked:f=>{f?c.add(a.id):c.delete(a.id)}},null)},default(){return e(ue,{description:a.description},{header(){return e("div",null,[e(y,B({ghost:!0,type:"primary",text:!0,class:"!font-medium"},a.projectUrl?{tag:"a",href:a.projectUrl,target:"_blank"}:{}),{default:()=>[a.name]})])},footer(){return e(ce,null,{default:()=>[e(de,{class:"pl-[3.6rem] text-[var(--clear-color-pressed)] text-sm"},{default:()=>[e("span",null,[b("\u521B\u5EFA\u4E8E "),pe(a.created)]),a.modified&&e("span",null,[b("\u66F4\u65B0\u4E8E")," ",e(ye,{time:a.modified},null)])]})]})},"header-extra":function(){return e(Te,null,{default:()=>[e(y,{onClick:()=>{fe.push({name:me.EditProject,query:{id:a.id}})}},{default:()=>[b("\u7F16\u8F91")]}),e(Fe,{class:"!p-0",options:[{value:"del",label:"",render(){return e(y,{type:"error",bordered:!1,onClick:async()=>{await N.api.projects(a.id).delete(),l.success("\u5220\u9664\u6210\u529F"),await r(s.value.currentPage)}},{default:()=>[b("\u5220\u9664")]})}}]},{default:()=>[e(y,{class:"!px-2"},{default:()=>[e(Se,null,{default:()=>[e(he,null,null)]})]})]})]})},avatar(){let f;return a.avatar?e(O,{class:"align-center",circle:!0,src:a.avatar,size:"large"},null):e(O,{circle:!0,size:"large",class:"align-center"},Ve(f=a.name[0].toUpperCase())?f:{default:()=>[f]})}})}}))}})]})})}});export{Ze as default};
