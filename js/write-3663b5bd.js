import{H as V}from"./rounded-button-527354c9.js";import{P as k,S as E,M as T,T as $}from"./parse-content-d636caa2.js";import{E as M}from"./toggle-42bad408.js";import{f as h,j as B,k as H,l as A,m as v,p as O,n as w,R as d,H as i,u as W,E as q,a as t,F as I,br as z,I as D,C as F,bs as L,bt as j,W as Y,L as _}from"./index-d12868e1.js";import{U as G}from"./underline-input-f023063b.js";import{i as J}from"./isString-48ab9afe.js";import{N as K}from"./DynamicTags-dbcfa34e.js";import{N as u}from"./FormItem-c40e0e72.js";import{N}from"./Select-07750eb4.js";import{N as R}from"./Switch-1916f3ad.js";import{N as Q}from"./InputNumber-911f731c.js";import"./DynamicInput-859765c5.js";import"./ChevronRight-0b09885c.js";import"./Add-7dfeb60a.js";import"./ButtonGroup-477d4ed3.js";import"./Form-ba393540.js";import"./use-async-monaco-384bd4e7.js";import"./index-0ec46b47.js";import"./editor.main-8d5a4ff7.js";import"./use-save-confirm-e6ccd567.js";import"./js-yaml-fae8e8ce.js";import"./use-react-c61188f0.js";import"./throttle-6b7e9902.js";import"./Tag-ae5139ae.js";import"./prop-0f12dfb2.js";import"./index-17c3e39a.js";const Se=h(()=>{const S=B(),r=H(A);v(async()=>{await r.fetch()});const C=()=>({categoryId:r.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],summary:"",allowComment:!0,id:void 0,images:[],meta:void 0,pin:!1,pinOrder:1}),x=e=>{const l=L(a),n=Object.keys(l);for(const o in e)n.includes(o)&&(a[o]=e[o])},a=O(C()),s=w(()=>S.query.id),c=w(()=>r.get(a.categoryId)||r.data?.value?.[0]||{});v(async()=>{const e=s.value;if(e&&typeof e=="string"){const l=await d.api.posts(e).get();x(l.data)}});const g=i(!1),y=W(),P=q(),U=async()=>{const e={...a,categoryId:c.value.id,summary:a.summary&&a.summary.trim()!=""?a.summary.trim():null};if(s.value){if(!J(s.value))return;const l=s.value;await d.api.posts(l).put({data:e}),y.success("\u4FEE\u6539\u6210\u529F")}else await d.api.posts.post({data:e}),y.success("\u53D1\u5E03\u6210\u529F");P.push({name:j.ViewPost,hash:"|publish"})};return()=>t(F,{title:s.value?"\u4FEE\u6539\u6587\u7AE0":"\u64B0\u5199\u65B0\u6587\u7AE0",actionsElement:t(I,null,[t(k,{data:a,onHandleYamlParsedMeta:e=>{const{title:l,slug:n,...o}=e;a.title=l??a.title,a.slug=n??a.slug,a.meta={...o}}},null),t(V,{icon:t(z,null,null),onClick:U},null)]),footerButtonElement:t(I,null,[t("button",{onClick:()=>{g.value=!0}},[t(D,null,{default:()=>[t(E,null,null)]})])])},{default:()=>[t(T,{class:"mt-3 relative z-10",label:"\u60F3\u60F3\u53D6\u4E2A\u4EC0\u4E48\u6807\u9898\u597D\u5462~",value:a.title,onChange:e=>{a.title=e}},null),t("div",{class:"text-gray-500 py-3"},[t("label",{class:"prefix"},[`${Y}/${c.value.slug}/`]),t(G,{class:"ml-2",value:a.slug,onChange:e=>{a.slug=e}},null)]),t(M,{loading:!!(s.value&&typeof a.id>"u"),onChange:e=>{a.text=e},text:a.text},null),t($,{show:g.value,onUpdateShow:e=>{g.value=e},data:a},{default:()=>[t(u,{label:"\u5206\u7C7B",required:!0,path:"category"},{default:()=>[t(N,{placeholder:"\u8BF7\u9009\u62E9",value:c.value.id,onUpdateValue:e=>{a.categoryId=e},options:r.data.value?.map(e=>({label:e.name,value:e.id,key:e.id}))||[]},null)]}),t(u,{label:"\u6807\u7B7E"},{default:()=>[t(K,{value:a.tags,onUpdateValue:e=>{a.tags.length=0,a.tags.push(...e)}},{input({submit:e}){const l=h({setup(){const n=i([]),o=i(!1),b=i(""),f=i();return v(async()=>{o.value=!0,f.value&&f.value.$el.querySelector("input").focus();const{data:m}=await d.api.categories.get({params:{type:"Tag"}});n.value=m.map(p=>({label:`${p.name} (${p.count})`,value:p.name,key:p.name})),o.value=!1}),()=>t(N,{ref:f,size:"small",value:b.value,clearable:!0,loading:o.value,filterable:!0,tag:!0,options:n.value,onUpdateValue:m=>{b.value=m,e(m)}},null)}});return t(l,null,null)}})]}),t(u,{label:"\u6982\u8981"},{default:()=>[t(_,{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"\u6587\u7AE0\u6982\u8981",value:a.summary,onInput:e=>void(a.summary=e)},null)]}),t(u,{label:"\u7248\u6743\u6CE8\u660E",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(R,{value:a.copyright,onUpdateValue:e=>void(a.copyright=e)},null)]}),t(u,{label:"\u7F6E\u9876",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(R,{value:!!a.pin,onUpdateValue:e=>void(a.pin=e)},null)]}),t(u,{label:"\u7F6E\u9876",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(Q,{disabled:!a.pin,value:a.pinOrder,onUpdateValue:e=>void(a.pinOrder=e||1)},null)]})]})]})});export{Se as default};
