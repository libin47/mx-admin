import{H as h}from"./rounded-button-358f7de0.js";import{f as y,y as o,w as x,m as b,R as i,a as t,F as T,d4 as k,C as F,M as w,c1 as d,N as C,b as p,b_ as U,g as B,dk as E,c2 as A}from"./index-9c74e798.js";import{T as M}from"./index-2ce16a5c.js";import{b as S,a as I,N as P}from"./Upload-ec98a24f.js";import{N as z,a as g}from"./Tabs-720eaeeb.js";import{N as D}from"./ButtonGroup-0e0a6d3e.js";import{N as O}from"./Popconfirm-1e8a0c82.js";import{N as R}from"./Icon-f0c05555.js";import"./DataTable-29312976.js";import"./ChevronRight-e7429bf9.js";import"./Checkbox-a595bd1a.js";import"./index-8c9bd54a.js";import"./Tooltip-87d34610.js";import"./Select-af5d9eac.js";import"./Tag-fc1d507c.js";import"./Add-ba1c106b.js";import"./throttle-6de7725b.js";import"./Forward-4d98b12f.js";import"./prop-0f12dfb2.js";var le=y({setup(){const a=o("icon"),l=o([]);x(()=>a.value,()=>{m()}),b(()=>{m()});const u=o(!1),m=()=>{u.value=!0,i.api.files(a.value).get().then(({data:e})=>{l.value=e,u.value=!1})},n=o(!1),v=async e=>{if(a.value==="icon"){if(e.file.file?.type.startsWith("image"))return!0;message.error("\u53EA\u80FD\u4E0A\u4F20\u56FE\u7247\u6587\u4EF6\uFF0C\u8BF7\u91CD\u65B0\u4E0A\u4F20")}return!1},N=({file:e,event:r})=>{const s=r?.target,{url:c,name:f}=JSON.parse(s.responseText);return e.name=f,e.url=c,l.value.unshift({url:c,name:f}),e};return()=>t(F,{actionsElement:t(T,null,[t(h,{variant:"info",onClick:()=>{n.value=!0},icon:t(k,null,null)},null)])},{default:()=>[t(z,{value:a.value,onUpdateValue:e=>{a.value=e}},{default:()=>[t(g,{tab:"\u56FE\u6807",name:"icon"},null),t(g,{tab:"\u5934\u50CF",name:"avatar"},null)]}),t(M,{loading:u.value,data:l,columns:[{key:"name",title:"\u6587\u4EF6\u540D",width:300,ellipsis:{lineClamp:1,tooltip:!0}},{key:"url",title:"URL",render(e){return t(w,{placement:"bottom",class:"w-[400px]"},{trigger(){return t("a",{href:e.url,target:"_blank"},[e.url])},default(){return t(d,{bordered:!0},{default:()=>[t(S,{src:e.url},null)]})}})}},{key:"action",title:"\u64CD\u4F5C",width:150,render(e){return t(D,null,{default:()=>[t(O,{onPositiveClick:()=>{i.api.files(a.value)(e.name).delete().then(()=>{message.success("\u5220\u9664\u6210\u529F"),l.value=l.value.filter(r=>r.name!==e.name)})}},{trigger(){return t(C,{text:!0,type:"error",tertiary:!0,size:"tiny"},{default:()=>[p("\u5220\u9664")]})},default(){return`\u786E\u5B9A\u8981\u5220\u9664 ${e.name} \u5417\uFF1F`}})]})}}]},null),t(U,{closable:!0,closeOnEsc:!0,onClose:()=>{n.value=!1},show:n.value,onUpdateShow:e=>{n.value=e}},{default:()=>[t(d,{title:"\u6587\u4EF6\u4E0A\u4F20",class:"modal-card sm flex justify-center",closable:!0},{default:()=>[t(I,{class:"flex flex-col items-center w-full",headers:{authorization:B()||""},action:`${i.endpoint}/files/upload?type=${a.value}`,"directory-dnd":!0,multiple:!0,onBeforeUpload:v,onFinish:N,onError:e=>{const r=e.event?.target;if(e.file.status="error",!r)return message.warning("\u7F51\u7EDC\u5F02\u5E38"),e.file;const{message:s}=JSON.parse(r.responseText);return message.warning(s),e.file}},{default:()=>[t(P,{class:"flex flex-col items-center justify-center w-full m-auto py-28"},{default:()=>[t(R,{size:"48",depth:"3"},{default:()=>[t(E,null,null)]}),t(A,{class:"mt-2"},{default:()=>[p("\u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20")]})]})]})]})]})]})}});export{le as default};
