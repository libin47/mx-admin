import{dE as ne,dF as se,dG as re,dH as ue,f as b,y as m,aL as z,n as k,a6 as oe,k as U,q as j,p as I,w,a as e,F as x,P as ie,d as T,c1 as D,U as ce,aI as F,H as y,dI as de,c6 as pe,m as W,K as me,cI as J,R as g,dJ as fe,dK as X,bq as ve,dL as ye,bZ as be,c0 as ge,N,b as h,I as he,A as we,M as Ne,x as Y,E as K,dM as xe,br as ke,u as Se,dN as Ie,dO as L,dP as Ce,dd as Oe,cw as Te,j as De,C as Pe}from"./index-7367b2eb.js";import{R as Z}from"./relative-time-9ccfac2c.js";import{H as M}from"./rounded-button-d48625b1.js";import{N as Q,a as E,b as Ue}from"./DynamicInput-50e81716.js";import{N as C}from"./Form-0b928553.js";import{N as d}from"./FormItem-8af1af1f.js";import{N as je}from"./InputNumber-d946f0c6.js";import{N as ee}from"./Switch-be4c208e.js";import{N as Ae}from"./DynamicTags-231ca593.js";import{_}from"./CheckCircleOutlined-f2332851.js";import{i as P}from"./isEmpty-ef1d88bc.js";import{b as Fe,o as Ve}from"./omit-d59bfd17.js";import{N as Ee}from"./DatePicker-fd463889.js";import{a as qe}from"./DataTable-e0129444.js";import{N as Ke}from"./Popconfirm-a5fe0e62.js";import{N as Le}from"./Select-d394828c.js";import{U as Me}from"./index-fa093688.js";import{N as _e}from"./Upload-7c766d3f.js";import{N as Be,a as V}from"./Tabs-6dcbef9c.js";import"./ChevronRight-fddda33d.js";import"./Add-f98b66ed.js";import"./ButtonGroup-5b02a96a.js";import"./index-1034f523.js";import"./Tag-23362430.js";import"./prop-0108836c.js";import"./Forward-339836ca.js";import"./Checkbox-29e21660.js";import"./Icon-54ef011a.js";import"./Tooltip-b958537d.js";import"./throttle-2a0a0a1b.js";function Re(a){return ne(se(a).toLowerCase())}var $e=re(function(a,r,s){return r=r.toLowerCase(),a+(s?Re(r):r)}),Ge=$e,He=1,ze=4;function ae(a){return Fe(a,He|ze)}function B(a,r,s){return a==null?a:ue(a,r,s)}function O(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!ie(a)}const We="mt-6",Je={class:We,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"do-not-autofill"},te=Symbol("JSONSchemaFormInject"),Xe=b({props:{schema:{type:Object,required:!0},onValueChange:{type:Function,required:!1},initialValue:{type:Object,required:!0},getKey:{type:Function,required:!1,default:a=>a}},setup(a){const r=m(a.initialValue);z(()=>{a.onValueChange?.(r.value)},{flush:"post"});const s=k(()=>a.schema.definitions),c=k(()=>new Map(Object.entries(a.schema.definitions)));oe(te,{schema:a.schema,definitions:c,getKey:a.getKey});const l=k(()=>Object.keys(s.value)),u=m([l.value[0]]),t=U(j),o=I(Je);return w(()=>t.viewport.value.mobile,n=>{n?(o.labelPlacement="top",o.labelAlign="left"):(o.labelPlacement="left",o.labelAlign="right")},{immediate:!0}),()=>{let n,i;const{schema:p}=a;return e(x,null,[e(Q,{accordion:!0,defaultExpandedNames:u.value,displayDirective:"if"},O(n=l.value.map(f=>{const v=s.value[f];return v.title?e(E,{title:v.title,"data-schema":JSON.stringify(v)},{default:()=>[e(C,o,{default:()=>[e(le,{dataKey:a.getKey(f),formData:r,schema:v},null)]})]}):null}))?n:{default:()=>[n]}),p.ps.length?e(T,{vertical:!0},O(i=p.ps.map(f=>e(D,{class:"ml-4 mt-8 text-xs inline-block",depth:3},O(f)?f:{default:()=>[f]})))?i:{default:()=>[i]}):null])}}}),le=b({props:{schema:{type:Object,required:!0},formData:{type:Object,required:!0},dataKey:{type:String,required:!0}},setup(a){const{definitions:r,getKey:s}=ce(te,{});return()=>{const{schema:c,formData:l,dataKey:u}=a;return c?e(x,null,[Object.keys(c.properties).map(t=>{const o=c.properties[t];if(o.$ref){const n=r.value.get(o.$ref.split("/").at(-1));return e(le,{dataKey:`${s(u)}.${t}`,formData:l,schema:n},null)}return e(Ye,{value:F(l.value,`${s(u)}.${t}`,void 0),onUpdateValue:n=>{F(l.value,s(u))?B(l.value,`${s(u)}.${t}`,n):B(l.value,s(u),{...F(l.value,s(u),{}),[t]:n})},title:o.title,type:o.type,options:o?.["ui:options"],description:o.description},null)})]):null}}}),Ye=b({props:{type:{type:String,required:!0},title:{type:String,required:!0},description:{type:String},options:{type:Object,default:()=>({})},value:{type:Object,required:!0},onUpdateValue:{type:Function,required:!0}},setup(a){const r=m(a.value);z(()=>{a.onUpdateValue(r.value)});const s=()=>{const{options:u}=a;switch(a.type){case"url":case"string":{const{type:t}=u;return e(y,{inputProps:{id:de()},value:r.value,onUpdateValue:o=>{r.value=o},type:t||"text",showPasswordToggle:!0,autosize:t=="textarea"?{maxRows:5,minRows:3}:void 0,clearable:!0},null)}case"array":return e(Ae,{value:r.value,onUpdateValue:t=>{r.value=t}},null);case"boolean":return e(ee,{value:r.value,onUpdateValue:t=>{r.value=t}},null);case"integer":return e(je,{value:r.value,onUpdateValue:t=>{r.value=t}},null);default:return null}},c=U(j),l=k(()=>c.viewport.value.mobile?1:2);return()=>{const{title:u,options:t,description:o}=a,n=e(x,null,[e(d,{label:u},{default:()=>[o?e(T,{vertical:!0},{default:()=>[s(),e(D,{class:"text-xs",depth:3},O(o)?o:{default:()=>[o]})]}):s()]})]);return t.halfGrid&&l.value===2?e("div",{class:"w-1/2 inline-block"},[n]):n}}}),Ze="mt-6",Qe={class:Ze,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"chrome-off"},R={autosize:!0,clearable:!0,style:"min-width: 300px; max-width: 100%"},ea=b(()=>{const{setHeaderButtons:a}=pe();W(()=>{a(e(M,{disabled:!0,onClick:u,icon:e(_,null,null)},null))}),me(()=>{a(null)});const r=m();J(async()=>{await t(),r.value=await g.api.config.jsonschema.get({transform:!1})});let s={};const c=I($({})),l=m({});w(()=>c,i=>{l.value=X(s,ve(i))},{deep:!0}),w(()=>l.value,i=>{let p=!1;P(i)?p=!1:p=!0,a(e(M,{disabled:!p,icon:e(_,null,null),onClick:u},null))});async function u(){if(P(l.value))return;const i=Object.entries(l.value);for await(const[p,f]of i){const v=Object.fromEntries(Object.entries(f).map(([A,q])=>Array.isArray(q)?[A,c[p][A]]:[A,q]));await g.api.options(p).patch({data:v})}await t(),message.success("\u4FEE\u6539\u6210\u529F")}const t=async()=>{let i=await g.api.options.get();i=$(Ve(i,["ok"])),s=ae(i),Object.assign(c,i)},o=U(j),n=I(Qe);return w(()=>o.viewport.value.mobile,i=>{i?(n.labelPlacement="top",n.labelAlign="left"):(n.labelPlacement="left",n.labelAlign="right")},{immediate:!0}),()=>e(x,null,[e("div",{class:"pt-4"},null),r.value&&e(Xe,{initialValue:c,getKey:i=>i.split(".").map(p=>Ge(p)).join(".").replace("Dto",""),schema:r.value},null)])});function $(a){return fe({seo:{title:"",description:"",keywords:[]},url:{wsUrl:"",adminUrl:"",serverUrl:"",webUrl:""},mailOptions:{user:"",pass:"",options:{host:"",port:465},enable:!1},commentOptions:{antiSpam:!1,spamKeywords:[],blockIps:[],disableNoChinese:!1},backupOptions:{enable:!1,secretId:"",secretKey:"",bucket:"",region:""},baiduSearchOptions:{enable:!1,token:""},algoliaSearchOptions:{enable:!1},adminExtra:{enableAdminProxy:!1,background:"",gaodemapKey:"",title:"\u9759\u304B\u306A\u68EE"},terminalOptions:{enable:!1,script:""},friendLinkOptions:{allowApply:!0},textOptions:{macros:!1}},a)}const aa=b(()=>()=>e(x,null,[e("div",{class:"pt-4"},null),e(Q,{defaultExpandedNames:["reset"],displayDirective:"show"},{default:()=>[e(E,{name:"reset",title:"\u4FEE\u6539\u5BC6\u7801"},{default:()=>[e(la,null,null)]}),e(E,{name:"token",title:"API Token"},{default:()=>[e(ta,null,null)]})]})])),ta=b(()=>{const a=m([]),r=()=>({name:"",expired:!1,expiredTime:new Date}),s=I(r()),c=async()=>{const{data:n}=await g.api.auth.token.get();a.value=n};J(()=>{c()});const l=m(!1),u=async()=>{const n={name:s.name,expired:s.expired?s.expiredTime.toISOString():void 0},i=await g.api.auth.token.post({data:n});await navigator.clipboard.writeText(i.token),l.value=!1;const p=r();for(const v in p)s[v]=p[v];message.success(`\u751F\u6210\u6210\u529F, Token \u5DF2\u590D\u5236, ${i.token}`),await c();const f=a.value.findIndex(v=>v.name===n.name);f!==-1&&(a.value[f].token=i.token)},t=async n=>{await g.api.auth.token.delete({params:{id:n}}),message.success("\u5220\u9664\u6210\u529F");const i=a.value.findIndex(p=>p.id===n);i!=-1&&a.value.splice(i,1)},o=U(j);return()=>e(ye,{class:"!overflow-visible"},{default:()=>[e(be,{transformOrigin:"center",show:l.value,onUpdateShow:n=>void(l.value=n)},{default:()=>[e(ge,{bordered:!1,title:"\u521B\u5EFA Token",class:"max-w-full w-[500px]"},{default:()=>[e(C,null,{default:()=>[e(d,{label:"\u540D\u79F0",required:!0},{default:()=>[e(y,{value:s.name,onInput:n=>void(s.name=n)},null)]}),e(d,{label:"\u662F\u5426\u8FC7\u671F"},{default:()=>[e(ee,{value:s.expired,onUpdateValue:n=>void(s.expired=n)},null)]}),e(d,{label:"\u8FC7\u671F\u65F6\u95F4"},{default:()=>[e(Ee,{disabled:!s.expired,value:s.expiredTime,type:"datetime",onUpdateValue:n=>void(s.expiredTime=new Date(n))},null)]})]}),e(T,null,{default:()=>[e(N,{round:!0,onClick:()=>void(l.value=!1)},{default:()=>[h("\u53D6\u6D88")]}),e(N,{round:!0,type:"primary",onClick:u},{default:()=>[h("\u786E\u5B9A")]})]})]})]}),e(N,{class:"absolute right-0 top-[-3rem]",round:!0,type:"primary",onClick:()=>{l.value=!0}},{default:()=>[e(he,null,{default:()=>[e(we,null,null)]}),e("span",{class:"ml-2"},[h("\u65B0\u589E")])]}),e(qe,{scrollX:Math.max(800,o.contentWidth.value-o.contentInsetWidth.value),remote:!0,bordered:!1,data:a.value,columns:[{key:"name",title:"\u540D\u79F0"},{key:"token",title:"Token",render({token:n}){return n??"*".repeat(40)}},{title:"\u521B\u5EFA\u65F6\u95F4",key:"created",render({created:n}){return e(Z,{time:n},null)}},{title:"\u8FC7\u671F\u65F6\u95F4",key:"expired",render({expired:n}){return Ne(n,"yyyy\u5E74M\u6708d\u65E5 HH:mm:ss")}},{title:"\u64CD\u4F5C",key:"id",render({id:n,name:i}){return e(T,null,{default:()=>[e(Ke,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:()=>{t(n)}},{trigger:()=>e(N,{text:!0,type:"error"},{default:()=>[h("\u5220\u9664")]}),default:()=>e("span",{class:"max-w-48"},[h('\u786E\u5B9A\u8981\u5220\u9664 Token "'),i,h('"?')])})]})}}]},null)]})}),la=b(()=>{const a=I({password:"",reenteredPassword:""}),r=m(),s=Y(),c=async()=>{!r.value||r.value.validate(async u=>{u?console.log(u):(await g.api.master.patch({data:{password:a.password}}),message.success("\u66F4\u6539\u6210\u529F"),xe(),s.push({name:ke.Login}))})};function l(u,t){return console.log(u),t===a.password}return()=>e(C,{class:"max-w-[300px]",ref:r,model:a,rules:{password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"}],reenteredPassword:[{required:!0,message:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801",trigger:["input","blur"]},{validator:l,message:"\u4E24\u6B21\u5BC6\u7801\u8F93\u5165\u4E0D\u4E00\u81F4",trigger:["blur","password-input"]}]}},{default:()=>[e(d,{label:"\u65B0\u5BC6\u7801",required:!0,path:"password"},{default:()=>[e(y,K(R,{value:a.password,onInput:u=>void(a.password=u),type:"password"}),null)]}),e(d,{label:"\u91CD\u590D\u5BC6\u7801",required:!0,path:"reenteredPassword"},{default:()=>[e(y,K(R,{value:a.reenteredPassword,onInput:u=>void(a.reenteredPassword=u),type:"password"}),null)]}),e("div",{class:"w-full text-right"},[e(N,{onClick:c,type:"primary",round:!0},{default:()=>[h("\u4FDD\u5B58")]})])]})}),na=b({props:{value:{type:Object,required:!0},onChange:{type:Function,required:!0},options:{type:Array,required:!1}},setup(a){const r=P(a.value)?null:a.value,s=w(()=>a.value,l=>{if(!r&&l){const u=Object.entries(l).map(([t,o])=>({key:t,value:o.toString()}));c.value=u,s()}}),c=m([]);return w(()=>c.value,l=>{const u=l.reduce((t,o)=>(o.key===""&&o.value===""||(t[o.key]=o.value.toString()),t),{});a.onChange(u)},{deep:!0}),()=>e(Ue,{value:c.value,onUpdateValue:l=>{c.value=(()=>{const u=l.findIndex(t=>t===null);return u!==-1&&l.splice(u,1,{key:"",value:""}),l})()}},{default(l){return e("div",{class:"flex items-center w-full"},[e(Le,{class:"mr-4",filterable:!0,tag:!0,placeholder:"\u8BF7\u9009\u62E9",value:l.value.key,onUpdateValue:u=>{l.value.key=u},options:a.options},null),e(y,{value:l.value.value.toString(),onUpdateValue:u=>{l.value.value=u}},null)])}})}}),G={GitHub:"github",Weibo:"weibo",\u7F51\u6613\u4E91:"netease",\u54D4\u54E9\u54D4\u54E9:"bilibili"},sa="_avatar_7rrjr_3";var H={"tab-user":"_tab-user_7rrjr_1",avatar:sa};const ra=b(()=>{const a=m({});let r;async function s(){const t=await g.api.master.get();a.value=t,r={...t}}W(async()=>{await s()});const c=Se(),l=k(()=>X(r,a.value)),u=async()=>{const t=ae(Te(l));t.socialIds&&(t.socialIds=a.value.socialIds),await g.api.master.patch({data:t}),c.success("\u4FDD\u5B58\u6210\u529F~"),await s()};return()=>e(x,null,[e(Ie,{cols:"1 400:1 600:2",class:H["tab-user"],xGap:20,yGap:20},{default:()=>[e(L,null,{default:()=>[e(C,{class:"flex flex-col justify-center items-center "},{default:()=>[e(d,null,{default:()=>[e("div",{class:H.avatar},[e(Me,{type:"avatar",onFinish:t=>{const{file:o,event:n}=t;try{const i=JSON.parse((n?.target).responseText);a.value.avatar=i.url}catch{}return o}},{default:()=>[e(_e,{class:"border-0 bg-transparent hover:border-0"},{default:()=>[e(Ce,{src:a.value.avatar,size:200},null)]})]})])]}),e(d,{label:"\u4E0A\u6B21\u767B\u5F55\u65F6\u95F4",class:"!mt-4"},{default:()=>[e("div",{class:"text-center w-full"},[e(D,null,{default:()=>[a.value.lastLoginTime?e(Z,{time:a.value.lastLoginTime},null):"N/A"]})])]}),e(d,{label:"\u4E0A\u6B21\u767B\u5F55\u5730\u5740"},{default:()=>[e("div",{class:"text-center w-full"},[a.value.lastLoginIp?e(Oe,{trigger:"hover",ip:a.value.lastLoginIp,triggerEl:e(D,{class:"cursor-pointer"},{default:()=>[a.value.lastLoginIp]})},null):"N/A"])]}),e(d,null,{default:()=>[e(N,{round:!0,class:"-mt-14",type:"primary",onClick:u,disabled:P(l.value)},{default:()=>[h("\u4FDD\u5B58")]})]})]})]}),e(L,null,{default:()=>[e(C,null,{default:()=>[e(d,{label:"\u4E3B\u4EBA\u540D (username)"},{default:()=>[e(y,{value:a.value.username,onInput:t=>{a.value.username=t?.trim()||""}},null)]}),e(d,{label:"\u4E3B\u4EBA\u6635\u79F0 (name)"},{default:()=>[e(y,{value:a.value.name,onInput:t=>{a.value.name=t?.trim()||""}},null)]}),e(d,{label:"\u4E3B\u4EBA\u90AE\u7BB1 (mail)"},{default:()=>[e(y,{value:a.value.mail,onInput:t=>{a.value.mail=t}},null)]}),e(d,{label:"\u4E2A\u4EBA\u9996\u9875"},{default:()=>[e(y,{value:a.value.url,onInput:t=>{a.value.url=t}},null)]}),e(d,{label:"\u5934\u50CF"},{default:()=>[e(y,{value:a.value.avatar,onInput:t=>{a.value.avatar=t}},null)]}),e(d,{label:"\u4E2A\u4EBA\u4ECB\u7ECD"},{default:()=>[e(y,{type:"textarea",resizable:!1,value:a.value.introduce,onInput:t=>{a.value.introduce=t}},null)]}),e(d,{label:"\u793E\u4EA4\u5E73\u53F0 ID \u5F55\u5165"},{default:()=>[e(na,{options:Object.keys(G).map(t=>({label:t,value:G[t]})),onChange:t=>{a.value.socialIds=t},value:a.value.socialIds||{}},null)]})]})]})]})])});var S;(function(a){a.User="user",a.System="system",a.Security="security"})(S||(S={}));var qa=b({setup(){const a=De(),r=Y(),s=m(a.params.type);w(()=>a.params.type,l=>{!l||(s.value=l)});const c=m(null);return()=>e(Pe,{actionsElement:c.value},{default:()=>[e(Be,{value:s.value,onUpdateValue:l=>{r.replace({...a,params:{...a.params,type:l}})}},{default:()=>[e(V,{tab:"\u7528\u6237",name:S.User},{default:()=>[e(ra,null,null)]}),e(V,{tab:"\u7CFB\u7EDF",name:S.System},{default:()=>[e(ea,null,null)]}),e(V,{tab:"\u5B89\u5168",name:S.Security},{default:()=>[e(aa,null,null)]})]})]})}});export{qa as default};
