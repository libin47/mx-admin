import{H as P}from"./rounded-button-358f7de0.js";import{P as U,S as T,M as V,T as $}from"./parse-content-39cd800c.js";import{E}from"./toggle-63667081.js";import{f as b,j as M,k as B,l as H,m as v,p as q,n as w,R as c,y as r,u as W,x as z,a as t,F as I,bq as D,I as F,C as j,br as A,bs as L,W as O,H as Y}from"./index-9c74e798.js";import{U as _}from"./underline-input-cdb70343.js";import{i as G}from"./isString-bed72e53.js";import{N as J}from"./DynamicTags-752a5869.js";import{N as p}from"./FormItem-6a6aac9c.js";import{N as R}from"./Select-af5d9eac.js";import{N as K}from"./Switch-3f24dc07.js";import"./DynamicInput-3fef3207.js";import"./ChevronRight-e7429bf9.js";import"./Add-ba1c106b.js";import"./ButtonGroup-0e0a6d3e.js";import"./InputNumber-a509de4e.js";import"./Form-ad4f2a91.js";import"./use-async-monaco-42a4a3f7.js";import"./index-2deee66d.js";import"./editor.main-4db047be.js";import"./use-save-confirm-f3a5b2e9.js";import"./js-yaml-fae8e8ce.js";import"./use-react-c24c6420.js";import"./throttle-6de7725b.js";import"./Tag-fc1d507c.js";import"./prop-0f12dfb2.js";import"./index-8c9bd54a.js";const Se=b(()=>{const S=M(),u=B(H);v(async()=>{await u.fetch()});const C=()=>({categoryId:u.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],summary:"",allowComment:!0,id:void 0,images:[],meta:void 0}),x=e=>{const l=A(a),n=Object.keys(l);for(const o in e)n.includes(o)&&(a[o]=e[o])},a=q(C()),s=w(()=>S.query.id),d=w(()=>u.get(a.categoryId)||u.data?.value?.[0]||{});v(async()=>{const e=s.value;if(e&&typeof e=="string"){const l=await c.api.posts(e).get();x(l.data)}});const g=r(!1),y=W(),N=z(),k=async()=>{const e={...a,categoryId:d.value.id,summary:a.summary&&a.summary.trim()!=""?a.summary.trim():null};if(s.value){if(!G(s.value))return;const l=s.value;await c.api.posts(l).put({data:e}),y.success("\u4FEE\u6539\u6210\u529F")}else await c.api.posts.post({data:e}),y.success("\u53D1\u5E03\u6210\u529F");N.push({name:L.ViewPost,hash:"|publish"})};return()=>t(j,{title:s.value?"\u4FEE\u6539\u6587\u7AE0":"\u64B0\u5199\u65B0\u6587\u7AE0",actionsElement:t(I,null,[t(U,{data:a,onHandleYamlParsedMeta:e=>{const{title:l,slug:n,...o}=e;a.title=l??a.title,a.slug=n??a.slug,a.meta={...o}}},null),t(P,{icon:t(D,null,null),onClick:k},null)]),footerButtonElement:t(I,null,[t("button",{onClick:()=>{g.value=!0}},[t(F,null,{default:()=>[t(T,null,null)]})])])},{default:()=>[t(V,{class:"mt-3 relative z-10",label:"\u60F3\u60F3\u53D6\u4E2A\u4EC0\u4E48\u6807\u9898\u597D\u5462~",value:a.title,onChange:e=>{a.title=e}},null),t("div",{class:"text-gray-500 py-3"},[t("label",{class:"prefix"},[`${O}/${d.value.slug}/`]),t(_,{class:"ml-2",value:a.slug,onChange:e=>{a.slug=e}},null)]),t(E,{loading:!!(s.value&&typeof a.id>"u"),onChange:e=>{a.text=e},text:a.text},null),t($,{show:g.value,onUpdateShow:e=>{g.value=e},data:a},{default:()=>[t(p,{label:"\u5206\u7C7B",required:!0,path:"category"},{default:()=>[t(R,{placeholder:"\u8BF7\u9009\u62E9",value:d.value.id,onUpdateValue:e=>{a.categoryId=e},options:u.data.value?.map(e=>({label:e.name,value:e.id,key:e.id}))||[]},null)]}),t(p,{label:"\u6807\u7B7E"},{default:()=>[t(J,{value:a.tags,onUpdateValue:e=>{a.tags.length=0,a.tags.push(...e)}},{input({submit:e}){const l=b({setup(){const n=r([]),o=r(!1),h=r(""),f=r();return v(async()=>{o.value=!0,f.value&&f.value.$el.querySelector("input").focus();const{data:i}=await c.api.categories.get({params:{type:"Tag"}});n.value=i.map(m=>({label:`${m.name} (${m.count})`,value:m.name,key:m.name})),o.value=!1}),()=>t(R,{ref:f,size:"small",value:h.value,clearable:!0,loading:o.value,filterable:!0,tag:!0,options:n.value,onUpdateValue:i=>{h.value=i,e(i)}},null)}});return t(l,null,null)}})]}),t(p,{label:"\u6982\u8981"},{default:()=>[t(Y,{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"\u6587\u7AE0\u6982\u8981",value:a.summary,onInput:e=>void(a.summary=e)},null)]}),t(p,{label:"\u7248\u6743\u6CE8\u660E",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(K,{value:a.copyright,onUpdateValue:e=>void(a.copyright=e)},null)]})]})]})});export{Se as default};
