import{dD as ne,dE as se,dF as re,dG as ue,f as y,y as m,aI as W,n as x,a6 as oe,k as U,q as j,p as I,w,a as e,F as k,P as ie,d as D,c0 as T,U as ce,aF as A,H as b,c5 as de,m as z,K as pe,cH as J,R as g,dH as me,dI as Y,bn as fe,dJ as ve,bY as be,b$ as ye,N,b as h,I as ge,A as he,M as we,x as X,E as K,dK as Ne,bo as ke,u as xe,dL as Se,dM as L,dN as Ie,dc as Ce,cv as Oe,j as De,C as Te}from"./index-44de73b8.js";import{R as Q}from"./relative-time-48d5fbd0.js";import{H as M}from"./rounded-button-ca5bd9f3.js";import{N as Z,a as E,b as Pe}from"./DynamicInput-0caad07b.js";import{N as C}from"./Form-c420edc4.js";import{N as d}from"./FormItem-2598ad4a.js";import{N as Ue}from"./InputNumber-7ce9df7d.js";import{N as ee}from"./Switch-c746fddb.js";import{N as je}from"./DynamicTags-0bd05039.js";import{_}from"./CheckCircleOutlined-4340f849.js";import{i as P}from"./isEmpty-a470ff5b.js";import{b as Fe,o as Ae}from"./omit-114f8f3b.js";import{N as Ve}from"./DatePicker-bae48d82.js";import{a as Ee}from"./DataTable-c60feb5a.js";import{N as qe}from"./Popconfirm-7b0f0517.js";import{N as Ke}from"./Select-038acb81.js";import{U as Le}from"./index-5ecf9567.js";import{N as Me}from"./Upload-7772210e.js";import{N as _e,a as V}from"./Tabs-054814fa.js";import"./ChevronRight-c12a4a39.js";import"./Add-f33050aa.js";import"./ButtonGroup-58b0f927.js";import"./index-cd040040.js";import"./Tag-a74b1f55.js";import"./prop-46b62c35.js";import"./Forward-3a192c18.js";import"./Checkbox-91e0c12a.js";import"./Icon-64b083fc.js";import"./Tooltip-6176f03e.js";import"./throttle-7a7d7907.js";function Be(a){return ne(se(a).toLowerCase())}var $e=re(function(a,r,s){return r=r.toLowerCase(),a+(s?Be(r):r)}),Re=$e,He=1,Ge=4;function ae(a){return Fe(a,He|Ge)}function B(a,r,s){return a==null?a:ue(a,r,s)}function O(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!ie(a)}const We="mt-6",ze={class:We,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"do-not-autofill"},te=Symbol("JSONSchemaFormInject"),Je=y({props:{schema:{type:Object,required:!0},onValueChange:{type:Function,required:!1},initialValue:{type:Object,required:!0},getKey:{type:Function,required:!1,default:a=>a}},setup(a){const r=m(a.initialValue);W(()=>{a.onValueChange?.(r.value)},{flush:"post"});const s=x(()=>a.schema.definitions),c=x(()=>new Map(Object.entries(a.schema.definitions)));oe(te,{schema:a.schema,definitions:c,getKey:a.getKey});const l=x(()=>Object.keys(s.value)),u=m([l.value[0]]),t=U(j),o=I(ze);return w(()=>t.viewport.value.mobile,n=>{n?(o.labelPlacement="top",o.labelAlign="left"):(o.labelPlacement="left",o.labelAlign="right")},{immediate:!0}),()=>{let n,i;const{schema:p}=a;return e(k,null,[e(Z,{accordion:!0,defaultExpandedNames:u.value,displayDirective:"if"},O(n=l.value.map(f=>{const v=s.value[f];return v.title?e(E,{title:v.title,"data-schema":JSON.stringify(v)},{default:()=>[e(C,o,{default:()=>[e(le,{dataKey:a.getKey(f),formData:r,schema:v},null)]})]}):null}))?n:{default:()=>[n]}),p.ps.length?e(D,{vertical:!0},O(i=p.ps.map(f=>e(T,{class:"ml-4 mt-8 text-xs inline-block",depth:3},O(f)?f:{default:()=>[f]})))?i:{default:()=>[i]}):null])}}}),le=y({props:{schema:{type:Object,required:!0},formData:{type:Object,required:!0},dataKey:{type:String,required:!0}},setup(a){const{definitions:r,getKey:s}=ce(te,{});return()=>{const{schema:c,formData:l,dataKey:u}=a;return c?e(k,null,[Object.keys(c.properties).map(t=>{const o=c.properties[t];if(o.$ref){const n=r.value.get(o.$ref.split("/").at(-1));return e(le,{dataKey:`${s(u)}.${t}`,formData:l,schema:n},null)}return e(Ye,{value:A(l.value,`${s(u)}.${t}`,void 0),onUpdateValue:n=>{A(l.value,s(u))?B(l.value,`${s(u)}.${t}`,n):B(l.value,s(u),{...A(l.value,s(u),{}),[t]:n})},title:o.title,type:o.type,options:o?.["ui:options"]},null)})]):null}}}),Ye=y({props:{type:{type:String,required:!0},title:{type:String,required:!0},description:{type:String},options:{type:Object,default:()=>({})},value:{type:Object,required:!0},onUpdateValue:{type:Function,required:!0}},setup(a){const r=m(a.value);W(()=>{a.onUpdateValue(r.value)});const s=()=>{const{options:u}=a;switch(a.type){case"url":case"string":{const{showPassword:t}=u;return e(b,{value:r.value,onUpdateValue:o=>{r.value=o},type:t?"password":"text",showPasswordToggle:!0,clearable:!0},null)}case"array":return e(je,{value:r.value,onUpdateValue:t=>{r.value=t}},null);case"boolean":return e(ee,{value:r.value,onUpdateValue:t=>{r.value=t}},null);case"integer":return e(Ue,{value:r.value,onUpdateValue:t=>{r.value=t}},null);default:return null}},c=U(j),l=x(()=>c.viewport.value.mobile?1:2);return()=>{const{title:u,options:t,description:o}=a,n=e(k,null,[e(d,{label:u},{default:()=>[o?e(D,{vertical:!0},{default:()=>[s(),e(T,{class:"text-xs",depth:3},O(o)?o:{default:()=>[o]})]}):s()]})]);return t.halfGrid&&l.value===2?e("div",{class:"w-1/2 inline-block"},[n]):n}}}),Xe="mt-6",Qe={class:Xe,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"chrome-off"},$={autosize:!0,clearable:!0,style:"min-width: 300px; max-width: 100%"},Ze=y(()=>{const{setHeaderButtons:a}=de();z(()=>{a(e(M,{disabled:!0,onClick:u,icon:e(_,null,null)},null))}),pe(()=>{a(null)});const r=m();J(async()=>{await t(),r.value=await g.api.config.jsonschema.get({transform:!1})});let s={};const c=I(R({})),l=m({});w(()=>c,i=>{l.value=Y(s,fe(i))},{deep:!0}),w(()=>l.value,i=>{let p=!1;P(i)?p=!1:p=!0,a(e(M,{disabled:!p,icon:e(_,null,null),onClick:u},null))});async function u(){if(P(l.value))return;const i=Object.entries(l.value);for await(const[p,f]of i){const v=Object.fromEntries(Object.entries(f).map(([F,q])=>Array.isArray(q)?[F,c[p][F]]:[F,q]));await g.api.options(p).patch({data:v})}await t(),message.success("\u4FEE\u6539\u6210\u529F")}const t=async()=>{let i=await g.api.options.get();i=R(Ae(i,["ok"])),s=ae(i),Object.assign(c,i)},o=U(j),n=I(Qe);return w(()=>o.viewport.value.mobile,i=>{i?(n.labelPlacement="top",n.labelAlign="left"):(n.labelPlacement="left",n.labelAlign="right")},{immediate:!0}),()=>e(k,null,[e("div",{class:"pt-4"},null),r.value&&e(Je,{initialValue:c,getKey:i=>i.split(".").map(p=>Re(p)).join(".").replace("Dto",""),schema:r.value},null)])});function R(a){return me({seo:{title:"",description:"",keywords:[]},url:{wsUrl:"",adminUrl:"",serverUrl:"",webUrl:""},mailOptions:{user:"",pass:"",options:{host:"",port:465},enable:!1},commentOptions:{antiSpam:!1,spamKeywords:[],blockIps:[],disableNoChinese:!1},backupOptions:{enable:!1,secretId:"",secretKey:"",bucket:"",region:""},baiduSearchOptions:{enable:!1,token:""},algoliaSearchOptions:{enable:!1},adminExtra:{enableAdminProxy:!1,background:"",gaodemapKey:"",title:"\u9759\u304B\u306A\u68EE"},terminalOptions:{enable:!1,script:""},friendLinkOptions:{allowApply:!0},textOptions:{macros:!1}},a)}const ea=y(()=>()=>e(k,null,[e("div",{class:"pt-4"},null),e(Z,{defaultExpandedNames:["reset"],displayDirective:"show"},{default:()=>[e(E,{name:"reset",title:"\u4FEE\u6539\u5BC6\u7801"},{default:()=>[e(ta,null,null)]}),e(E,{name:"token",title:"API Token"},{default:()=>[e(aa,null,null)]})]})])),aa=y(()=>{const a=m([]),r=()=>({name:"",expired:!1,expiredTime:new Date}),s=I(r()),c=async()=>{const{data:n}=await g.api.auth.token.get();a.value=n};J(()=>{c()});const l=m(!1),u=async()=>{const n={name:s.name,expired:s.expired?s.expiredTime.toISOString():void 0},i=await g.api.auth.token.post({data:n});await navigator.clipboard.writeText(i.token),l.value=!1;const p=r();for(const v in p)s[v]=p[v];message.success(`\u751F\u6210\u6210\u529F, Token \u5DF2\u590D\u5236, ${i.token}`),await c();const f=a.value.findIndex(v=>v.name===n.name);f!==-1&&(a.value[f].token=i.token)},t=async n=>{await g.api.auth.token.delete({params:{id:n}}),message.success("\u5220\u9664\u6210\u529F");const i=a.value.findIndex(p=>p.id===n);i!=-1&&a.value.splice(i,1)},o=U(j);return()=>e(ve,{class:"!overflow-visible"},{default:()=>[e(be,{transformOrigin:"center",show:l.value,onUpdateShow:n=>void(l.value=n)},{default:()=>[e(ye,{bordered:!1,title:"\u521B\u5EFA Token",class:"max-w-full w-[500px]"},{default:()=>[e(C,null,{default:()=>[e(d,{label:"\u540D\u79F0",required:!0},{default:()=>[e(b,{value:s.name,onInput:n=>void(s.name=n)},null)]}),e(d,{label:"\u662F\u5426\u8FC7\u671F"},{default:()=>[e(ee,{value:s.expired,onUpdateValue:n=>void(s.expired=n)},null)]}),e(d,{label:"\u8FC7\u671F\u65F6\u95F4"},{default:()=>[e(Ve,{disabled:!s.expired,value:s.expiredTime,type:"datetime",onUpdateValue:n=>void(s.expiredTime=new Date(n))},null)]})]}),e(D,null,{default:()=>[e(N,{round:!0,onClick:()=>void(l.value=!1)},{default:()=>[h("\u53D6\u6D88")]}),e(N,{round:!0,type:"primary",onClick:u},{default:()=>[h("\u786E\u5B9A")]})]})]})]}),e(N,{class:"absolute right-0 top-[-3rem]",round:!0,type:"primary",onClick:()=>{l.value=!0}},{default:()=>[e(ge,null,{default:()=>[e(he,null,null)]}),e("span",{class:"ml-2"},[h("\u65B0\u589E")])]}),e(Ee,{scrollX:Math.max(800,o.contentWidth.value-o.contentInsetWidth.value),remote:!0,bordered:!1,data:a.value,columns:[{key:"name",title:"\u540D\u79F0"},{key:"token",title:"Token",render({token:n}){return n??"*".repeat(40)}},{title:"\u521B\u5EFA\u65F6\u95F4",key:"created",render({created:n}){return e(Q,{time:n},null)}},{title:"\u8FC7\u671F\u65F6\u95F4",key:"expired",render({expired:n}){return we(n,"yyyy\u5E74M\u6708d\u65E5 HH:mm:ss")}},{title:"\u64CD\u4F5C",key:"id",render({id:n,name:i}){return e(D,null,{default:()=>[e(qe,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:()=>{t(n)}},{trigger:()=>e(N,{text:!0,type:"error"},{default:()=>[h("\u5220\u9664")]}),default:()=>e("span",{class:"max-w-48"},[h('\u786E\u5B9A\u8981\u5220\u9664 Token "'),i,h('"?')])})]})}}]},null)]})}),ta=y(()=>{const a=I({password:"",reenteredPassword:""}),r=m(),s=X(),c=async()=>{!r.value||r.value.validate(async u=>{u?console.log(u):(await g.api.master.patch({data:{password:a.password}}),message.success("\u66F4\u6539\u6210\u529F"),Ne(),s.push({name:ke.Login}))})};function l(u,t){return console.log(u),t===a.password}return()=>e(C,{class:"max-w-[300px]",ref:r,model:a,rules:{password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"}],reenteredPassword:[{required:!0,message:"\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801",trigger:["input","blur"]},{validator:l,message:"\u4E24\u6B21\u5BC6\u7801\u8F93\u5165\u4E0D\u4E00\u81F4",trigger:["blur","password-input"]}]}},{default:()=>[e(d,{label:"\u65B0\u5BC6\u7801",required:!0,path:"password"},{default:()=>[e(b,K($,{value:a.password,onInput:u=>void(a.password=u),type:"password"}),null)]}),e(d,{label:"\u91CD\u590D\u5BC6\u7801",required:!0,path:"reenteredPassword"},{default:()=>[e(b,K($,{value:a.reenteredPassword,onInput:u=>void(a.reenteredPassword=u),type:"password"}),null)]}),e("div",{class:"w-full text-right"},[e(N,{onClick:c,type:"primary",round:!0},{default:()=>[h("\u4FDD\u5B58")]})])]})}),la=y({props:{value:{type:Object,required:!0},onChange:{type:Function,required:!0},options:{type:Array,required:!1}},setup(a){const r=P(a.value)?null:a.value,s=w(()=>a.value,l=>{if(!r&&l){const u=Object.entries(l).map(([t,o])=>({key:t,value:o.toString()}));c.value=u,s()}}),c=m([]);return w(()=>c.value,l=>{const u=l.reduce((t,o)=>(o.key===""&&o.value===""||(t[o.key]=o.value.toString()),t),{});a.onChange(u)},{deep:!0}),()=>e(Pe,{value:c.value,onUpdateValue:l=>{c.value=(()=>{const u=l.findIndex(t=>t===null);return u!==-1&&l.splice(u,1,{key:"",value:""}),l})()}},{default(l){return e("div",{class:"flex items-center w-full"},[e(Ke,{class:"mr-4",filterable:!0,tag:!0,placeholder:"\u8BF7\u9009\u62E9",value:l.value.key,onUpdateValue:u=>{l.value.key=u},options:a.options},null),e(b,{value:l.value.value.toString(),onUpdateValue:u=>{l.value.value=u}},null)])}})}}),H={GitHub:"github",Weibo:"weibo",\u7F51\u6613\u4E91:"netease",\u54D4\u54E9\u54D4\u54E9:"bilibili"},na="_avatar_7rrjr_3";var G={"tab-user":"_tab-user_7rrjr_1",avatar:na};const sa=y(()=>{const a=m({});let r;async function s(){const t=await g.api.master.get();a.value=t,r={...t}}z(async()=>{await s()});const c=xe(),l=x(()=>Y(r,a.value)),u=async()=>{const t=ae(Oe(l));t.socialIds&&(t.socialIds=a.value.socialIds),await g.api.master.patch({data:t}),c.success("\u4FDD\u5B58\u6210\u529F~"),await s()};return()=>e(k,null,[e(Se,{cols:"1 400:1 600:2",class:G["tab-user"],xGap:20,yGap:20},{default:()=>[e(L,null,{default:()=>[e(C,{class:"flex flex-col justify-center items-center "},{default:()=>[e(d,null,{default:()=>[e("div",{class:G.avatar},[e(Le,{type:"avatar",onFinish:t=>{const{file:o,event:n}=t;try{const i=JSON.parse((n?.target).responseText);a.value.avatar=i.url}catch{}return o}},{default:()=>[e(Me,{class:"border-0 bg-transparent hover:border-0"},{default:()=>[e(Ie,{src:a.value.avatar,size:200},null)]})]})])]}),e(d,{label:"\u4E0A\u6B21\u767B\u5F55\u65F6\u95F4",class:"!mt-4"},{default:()=>[e("div",{class:"text-center w-full"},[e(T,null,{default:()=>[a.value.lastLoginTime?e(Q,{time:a.value.lastLoginTime},null):"N/A"]})])]}),e(d,{label:"\u4E0A\u6B21\u767B\u5F55\u5730\u5740"},{default:()=>[e("div",{class:"text-center w-full"},[a.value.lastLoginIp?e(Ce,{trigger:"hover",ip:a.value.lastLoginIp,triggerEl:e(T,{class:"cursor-pointer"},{default:()=>[a.value.lastLoginIp]})},null):"N/A"])]}),e(d,null,{default:()=>[e(N,{round:!0,class:"-mt-14",type:"primary",onClick:u,disabled:P(l.value)},{default:()=>[h("\u4FDD\u5B58")]})]})]})]}),e(L,null,{default:()=>[e(C,null,{default:()=>[e(d,{label:"\u4E3B\u4EBA\u540D (username)"},{default:()=>[e(b,{value:a.value.username,onInput:t=>{a.value.username=t?.trim()||""}},null)]}),e(d,{label:"\u4E3B\u4EBA\u6635\u79F0 (name)"},{default:()=>[e(b,{value:a.value.name,onInput:t=>{a.value.name=t?.trim()||""}},null)]}),e(d,{label:"\u4E3B\u4EBA\u90AE\u7BB1 (mail)"},{default:()=>[e(b,{value:a.value.mail,onInput:t=>{a.value.mail=t}},null)]}),e(d,{label:"\u4E2A\u4EBA\u9996\u9875"},{default:()=>[e(b,{value:a.value.url,onInput:t=>{a.value.url=t}},null)]}),e(d,{label:"\u5934\u50CF"},{default:()=>[e(b,{value:a.value.avatar,onInput:t=>{a.value.avatar=t}},null)]}),e(d,{label:"\u4E2A\u4EBA\u4ECB\u7ECD"},{default:()=>[e(b,{type:"textarea",resizable:!1,value:a.value.introduce,onInput:t=>{a.value.introduce=t}},null)]}),e(d,{label:"\u793E\u4EA4\u5E73\u53F0 ID \u5F55\u5165"},{default:()=>[e(la,{options:Object.keys(H).map(t=>({label:t,value:H[t]})),onChange:t=>{a.value.socialIds=t},value:a.value.socialIds||{}},null)]})]})]})]})])});var S;(function(a){a.User="user",a.System="system",a.Security="security"})(S||(S={}));var Ea=y({setup(){const a=De(),r=X(),s=m(a.params.type);w(()=>a.params.type,l=>{!l||(s.value=l)});const c=m(null);return()=>e(Te,{actionsElement:c.value},{default:()=>[e(_e,{value:s.value,onUpdateValue:l=>{r.replace({...a,params:{...a.params,type:l}})}},{default:()=>[e(V,{tab:"\u7528\u6237",name:S.User},{default:()=>[e(sa,null,null)]}),e(V,{tab:"\u7CFB\u7EDF",name:S.System},{default:()=>[e(Ze,null,null)]}),e(V,{tab:"\u5B89\u5168",name:S.Security},{default:()=>[e(ea,null,null)]})]})]})}});export{Ea as default};
