import{f as S,k as A,H as f,u as w,m as C,a as e,F as T,dg as F,C as B,p as z,w as D,bQ as E,cA as I,b as i,R as g,d as N,N as m,bS as M,L as h}from"./index-d885f019.js";import{H as R}from"./rounded-button-6475331c.js";import{t as H}from"./index-3458d647.js";import{T as L}from"./title-link-3b69a455.js";import{u as V}from"./album-ae64f3d7.js";import{a as q}from"./DataTable-191a93c9.js";import{N as P}from"./Popconfirm-9e91c519.js";import{N as Q}from"./Form-1d9f54f3.js";import{N as y}from"./FormItemRow-2ad6d3f0.js";import"./iframe-preview-f468e6b6.js";import"./ExternalLink-4655a142.js";import"./ArrowDown-00ad04a7.js";import"./Checkbox-9a7e928d.js";import"./index-ed7b3e6e.js";import"./ChevronRight-ab7b1b96.js";import"./Tooltip-dfa056a2.js";import"./Select-f7ce401c.js";import"./Tag-b4c59312.js";import"./Pagination-929c7ebe.js";import"./Forward-8c76bb04.js";import"./prop-0f12dfb2.js";import"./FormItem-f234e47c.js";const me=S(u=>{const t=A(V),s=f(!0),o=t.fetch,a=w();C(async()=>{s.value=!0,await o(),s.value=!1});const n=f(!1),v=()=>({name:"",slug:""}),d=f(v());return()=>e(B,{actionsElement:e(T,null,[e(R,{variant:"success",icon:e(F,null,null),onClick:()=>{n.value=!0,d.value=v()}},null)])},{default:()=>[e(I,{prefix:"bar"},{default:()=>[i("\u5206\u7C7B")]}),e(x,{show:n,onSubmit:async l=>{const{name:c,slug:b}=l,p=typeof n.value=="string"?n.value:null;if(p){await g.api.albums(p).put({data:{name:c,slug:b,type:0}}),a.success("\u4FEE\u6539\u6210\u529F");const r=t.data.value.findIndex(k=>k.id==p);t.data.value[r]={...t.data.value[r],...l}}else{const r=await g.api.albums.post({data:{name:c,slug:b}});a.success("\u521B\u5EFA\u6210\u529F"),t.data.value.push(r.data)}},initialState:d.value},null),e(q,{rowClassName:()=>H,size:"small",bordered:!1,data:t.data.value||[],remote:!0,loading:s.value,columns:[{title:"\u540D\u79F0",key:"name",render(l){return l.name,e(L,{title:l.name,inPageTo:"/images/photos?id="+l.id},null)}},{title:"\u6570",key:"count"},{title:"\u8DEF\u5F84",key:"slug",width:300},{width:300,title:"\u64CD\u4F5C",fixed:"right",key:"id",render(l){return e(N,{size:12},{default:()=>[e(m,{size:"tiny",text:!0,type:"primary",onClick:c=>{d.value={name:l.name,slug:l.slug},n.value=l.id}},{default:()=>[i("\u7F16\u8F91")]}),e(P,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await g.api.albums(l.id).delete(),a.success("\u5220\u9664\u6210\u529F"),await t.fetch(!0)}},{trigger:()=>e(m,{text:!0,type:"error",size:"tiny"},{default:()=>[i("\u79FB\u9664")]}),default:()=>e("span",{style:{maxWidth:"12rem"}},[i("\u786E\u5B9A\u8981\u5220\u9664 "),l.title,i(" ?")])})]})}}]},null)]})}),x=S(u=>{const t=z(u.initialState??{name:"",slug:""});D(()=>u.initialState,a=>{a&&(t.name=a.name,t.slug=a.slug)});const s=w(),o=()=>{if(!t.name||!t.slug){s.error("\u540D\u5B57 \u548C \u8DEF\u5F84 \u4E0D\u80FD\u4E3A\u7A7A");return}u.onSubmit(t),u.show.value=!1};return()=>e(E,{show:!!u.show.value,onUpdateShow:a=>{u.show.value=a}},{default:()=>e(M,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:u.initialState?"\u7F16\u8F91":"\u65B0\u5EFA"},{default:()=>[e(Q,{onSubmit:o,rules:{name:{required:!0,trigger:["input","blur"]},slug:{required:!0,trigger:["input","blur"]}}},{default:()=>[e(y,{path:"name",label:"\u540D\u5B57"},{default:()=>[e(h,{placeholder:"",onInput:a=>{t.name=a},value:t.name},null)]}),e(y,{path:"slug",label:"\u8DEF\u5F84"},{default:()=>[e(h,{placeholder:"",onInput:a=>{t.slug=a},value:t.slug},null)]}),e("div",{class:"text-center"},[e(N,{size:12,align:"center",inline:!0},{default:()=>[e(m,{type:"success",onClick:o,round:!0},{default:()=>[i("\u786E\u5B9A")]}),e(m,{onClick:()=>u.show.value=!1,round:!0},{default:()=>[i("\u53D6\u6D88")]})]})])]})]})})});x.props=["initialState","onSubmit","show"];export{me as ManageAlbumsListView};
