import{f as A,k as z,l as D,p as S,H as y,u as F,m as H,R as c,w as E,a as e,F as M,A as V,C as j,bQ as L,cA as x,b as r,d as w,N as d,S as O,x as q,bS as P,L as C}from"./index-d885f019.js";import{H as U}from"./rounded-button-6475331c.js";import{t as _}from"./index-3458d647.js";import{N as $}from"./Badge-a8b8ecd0.js";import{N as Q}from"./Tag-b4c59312.js";import{N as B}from"./FormItemRow-2ad6d3f0.js";import{a as T}from"./DataTable-191a93c9.js";import{N as G}from"./Popconfirm-9e91c519.js";import{N as J}from"./Form-1d9f54f3.js";import"./Select-f7ce401c.js";import"./FormItem-f234e47c.js";import"./index-ed7b3e6e.js";import"./ArrowDown-00ad04a7.js";import"./Checkbox-9a7e928d.js";import"./ChevronRight-ab7b1b96.js";import"./Tooltip-dfa056a2.js";import"./Pagination-929c7ebe.js";import"./Forward-8c76bb04.js";import"./prop-0f12dfb2.js";function K(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!O(u)}const fe=A(u=>{const a=z(D),m=S([]),o=y(!0),l=a.fetch,h=F();H(async()=>{o.value=!0,await l(),o.value=!1;const{data:s}=await c.api.categories.get({params:{type:"tag"}});m.push(...s)});const g=y(""),p=S([]);E(()=>g.value,async s=>{const t=await c.api.categories(s).get({params:{tag:"true"}});p.length=0,p.push(...t.data)});const i=y(!1),N=()=>({name:"",slug:""}),v=y(N());return()=>{let s;return e(j,{actionsElement:e(M,null,[e(U,{variant:"success",icon:e(V,null,null),onClick:()=>{i.value=!0,v.value=N()}},null)])},{default:()=>[e(x,{prefix:"bar"},{default:()=>[r("\u5206\u7C7B")]}),e(I,{show:i,onSubmit:async t=>{const{name:n,slug:k}=t,b=typeof i.value=="string"?i.value:null;if(b){await c.api.categories(b).put({data:{name:n,slug:k,type:0}}),h.success("\u4FEE\u6539\u6210\u529F");const f=a.data.value.findIndex(R=>R.id==b);a.data.value[f]={...a.data.value[f],...t}}else{const f=await c.api.categories.post({data:{name:n,slug:k}});h.success("\u521B\u5EFA\u6210\u529F"),a.data.value.push(f.data)}},initialState:v.value},null),e(T,{rowClassName:()=>_,bordered:!1,data:a.data.value||[],remote:!0,loading:o.value,columns:[{title:"\u540D\u79F0",key:"name"},{title:"\u6570",key:"count"},{title:"\u8DEF\u5F84",key:"slug",width:300},{width:300,title:"\u64CD\u4F5C",fixed:"right",key:"id",render(t){return e(w,{size:12},{default:()=>[e(d,{size:"tiny",text:!0,type:"primary",onClick:n=>{v.value={name:t.name,slug:t.slug},i.value=t.id}},{default:()=>[r("\u7F16\u8F91")]}),e(G,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await c.api.categories(t.id).delete(),h.success("\u5220\u9664\u6210\u529F"),await a.fetch(!0)}},{trigger:()=>e(d,{text:!0,type:"error",size:"tiny"},{default:()=>[r("\u79FB\u9664")]}),default:()=>e("span",{class:"max-w-48"},[r("\u786E\u5B9A\u8981\u5220\u9664 "),t.title,r(" ?")])})]})}}]},null),e(x,{prefix:"bar"},{default:()=>[r("\u6807\u7B7E")]}),e(w,{size:12},K(s=m.map(t=>e($,{value:t.count,key:t.name},{default:()=>[e(Q,{class:"border-gray-200 border",round:!0,type:"success",checkable:!0,bordered:!0,checked:g.value==t.name,onUpdateChecked:n=>{n?g.value=t.name:g.value=""}},{default:()=>[t.name]})]})))?s:{default:()=>[s]}),p.length!=0&&e(T,{remote:!0,class:"mt-4",data:p,columns:[{title:"\u6807\u9898",key:"title",render(t){return e(q,{to:`/posts/edit?id=${t.id}`},{default:()=>[e(d,{type:"primary",text:!0},{default:()=>[t.title]})]})}},{title:"\u5206\u7C7B",key:"category",render(t){return t.category.name}}]},null)]})}}),I=A(u=>{const a=S(u.initialState??{name:"",slug:""});E(()=>u.initialState,l=>{l&&(a.name=l.name,a.slug=l.slug)});const m=F(),o=()=>{if(!a.name||!a.slug){m.error("\u540D\u5B57 \u548C \u8DEF\u5F84 \u4E0D\u80FD\u4E3A\u7A7A");return}u.onSubmit(a),u.show.value=!1};return()=>e(L,{transformOrigin:"center",show:!!u.show.value,onUpdateShow:l=>{u.show.value=l}},{default:()=>e(P,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:u.initialState?"\u7F16\u8F91":"\u65B0\u5EFA"},{default:()=>[e(J,{onSubmit:o,model:a,rules:{name:{required:!0,trigger:["input","blur"]},slug:{required:!0,trigger:["input","blur"]}}},{default:()=>[e(B,{path:"name",label:"\u540D\u5B57"},{default:()=>[e(C,{placeholder:"",onInput:l=>{a.name=l},value:a.name},null)]}),e(B,{path:"slug",label:"\u8DEF\u5F84"},{default:()=>[e(C,{placeholder:"",onInput:l=>{a.slug=l},value:a.slug},null)]}),e("div",{class:"text-center"},[e(w,{size:12,align:"center",inline:!0},{default:()=>[e(d,{type:"success",onClick:o,round:!0},{default:()=>[r("\u786E\u5B9A")]}),e(d,{onClick:()=>u.show.value=!1,round:!0},{default:()=>[r("\u53D6\u6D88")]})]})])]})]})})});I.props=["initialState","onSubmit","show"];export{fe as CategoryView};
