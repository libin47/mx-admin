import{f as h,j as V,k,l as E,m as v,p as T,n as w,R as d,H as i,u as $,E as M,a as t,F as I,bs as B,I as H,C as O,bt as A,bu as W,W as q,L as z}from"./index-d885f019.js";import{H as D}from"./rounded-button-6475331c.js";import{P as F,T as L}from"./parse-content-64a73cf3.js";import{E as j}from"./toggle-996c5c52.js";import{S as Y,M as _}from"./material-input-6d95a91a.js";import{U as G}from"./underline-input-024bfe35.js";import{i as J}from"./isString-11b99797.js";import{N as K}from"./DynamicTags-81a1a809.js";import{N as u}from"./FormItem-f234e47c.js";import{N}from"./Select-f7ce401c.js";import{N as R}from"./Switch-9604b74c.js";import{N as Q}from"./InputNumber-901bbecb.js";import"./CollapseItem-746e00ae.js";import"./ChevronRight-ab7b1b96.js";import"./Form-1d9f54f3.js";import"./ButtonGroup-e00e1490.js";import"./use-async-monaco-6f514289.js";import"./index-e0e88b54.js";import"./editor.main-2c1c7cbd.js";import"./use-save-confirm-0ccf4a04.js";import"./DynamicInput-8cef70af.js";import"./Add-cf9d4bc6.js";import"./ArrowDown-00ad04a7.js";import"./js-yaml-fae8e8ce.js";import"./use-react-c9828f89.js";import"./throttle-6fa55e62.js";import"./Tag-b4c59312.js";import"./prop-0f12dfb2.js";import"./index-ed7b3e6e.js";const Pe=h(()=>{const S=V(),r=k(E);v(async()=>{await r.fetch()});const C=()=>({categoryId:r.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],summary:"",allowComment:!0,id:void 0,images:[],meta:void 0,pin:!1,pinOrder:1}),x=e=>{const l=A(a),n=Object.keys(l);for(const o in e)n.includes(o)&&(a[o]=e[o])},a=T(C()),s=w(()=>S.query.id),c=w(()=>r.get(a.categoryId)||r.data?.value?.[0]||{});v(async()=>{const e=s.value;if(e&&typeof e=="string"){const l=await d.api.posts(e).get();x(l.data)}});const g=i(!1),y=$(),P=M(),U=async()=>{const e={...a,categoryId:c.value.id,summary:a.summary&&a.summary.trim()!=""?a.summary.trim():null};if(s.value){if(!J(s.value))return;const l=s.value;await d.api.posts(l).put({data:e}),y.success("\u4FEE\u6539\u6210\u529F")}else await d.api.posts.post({data:e}),y.success("\u53D1\u5E03\u6210\u529F");P.push({name:W.ViewPost,hash:"|publish"})};return()=>t(O,{title:s.value?"\u4FEE\u6539\u6587\u7AE0":"\u64B0\u5199\u65B0\u6587\u7AE0",actionsElement:t(I,null,[t(F,{data:a,onHandleYamlParsedMeta:e=>{const{title:l,slug:n,...o}=e;a.title=l??a.title,a.slug=n??a.slug,a.meta={...o}}},null),t(D,{icon:t(B,null,null),onClick:U},null)]),footerButtonElement:t(I,null,[t("button",{onClick:()=>{g.value=!0}},[t(H,null,{default:()=>[t(Y,null,null)]})])])},{default:()=>[t(_,{class:"mt-3 relative z-10",label:"\u60F3\u60F3\u53D6\u4E2A\u4EC0\u4E48\u6807\u9898\u597D\u5462~",value:a.title,onChange:e=>{a.title=e}},null),t("div",{class:"text-gray-500 py-3"},[t("label",{class:"prefix"},[`${q}/${c.value.slug}/`]),t(G,{class:"ml-2",value:a.slug,onChange:e=>{a.slug=e}},null)]),t(j,{loading:!!(s.value&&typeof a.id>"u"),onChange:e=>{a.text=e},text:a.text},null),t(L,{show:g.value,onUpdateShow:e=>{g.value=e},data:a},{default:()=>[t(u,{label:"\u5206\u7C7B",required:!0,path:"category"},{default:()=>[t(N,{placeholder:"\u8BF7\u9009\u62E9",value:c.value.id,onUpdateValue:e=>{a.categoryId=e},options:r.data.value?.map(e=>({label:e.name,value:e.id,key:e.id}))||[]},null)]}),t(u,{label:"\u6807\u7B7E"},{default:()=>[t(K,{value:a.tags,onUpdateValue:e=>{a.tags.length=0,a.tags.push(...e)}},{input({submit:e}){const l=h({setup(){const n=i([]),o=i(!1),b=i(""),f=i();return v(async()=>{o.value=!0,f.value&&f.value.$el.querySelector("input").focus();const{data:m}=await d.api.categories.get({params:{type:"Tag"}});n.value=m.map(p=>({label:`${p.name} (${p.count})`,value:p.name,key:p.name})),o.value=!1}),()=>t(N,{ref:f,size:"small",value:b.value,clearable:!0,loading:o.value,filterable:!0,tag:!0,options:n.value,onUpdateValue:m=>{b.value=m,e(m)}},null)}});return t(l,null,null)}})]}),t(u,{label:"\u6982\u8981"},{default:()=>[t(z,{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"\u6587\u7AE0\u6982\u8981",value:a.summary,onInput:e=>void(a.summary=e)},null)]}),t(u,{label:"\u7248\u6743\u6CE8\u660E",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(R,{value:a.copyright,onUpdateValue:e=>void(a.copyright=e)},null)]}),t(u,{label:"\u7F6E\u9876",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(R,{value:!!a.pin,onUpdateValue:e=>{a.pin=e,e||(a.pinOrder=1)}},null)]}),t(u,{label:"\u7F6E\u9876",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(Q,{disabled:!a.pin,value:a.pinOrder,onUpdateValue:e=>void(a.pinOrder=e||1)},null)]})]})]})});export{Pe as default};
