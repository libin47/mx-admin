import{f as w,o as D,h as I,i as _,R as u,u as F,j as R,w as E,k as M,l as j,m as A,n as L,p as V,a as t,q as z,s as H,P as U,b as m,t as S,B as $,I as x,N as q,d as K,F as G,A as J,C as Q}from"./index-d885f019.js";import{T as W}from"./title-link-3b69a455.js";import{D as X}from"./delete-confirm-a760e989.js";import{T as Y}from"./index-3458d647.js";import{E as Z}from"./edit-column-41ba7ec2.js";import{R as T}from"./relative-time-610c2d0d.js";import{u as ee}from"./use-table-f4b6379e.js";import{H as te}from"./rounded-button-6475331c.js";import{N as ae}from"./Popconfirm-9e91c519.js";import"./iframe-preview-f468e6b6.js";import"./DataTable-191a93c9.js";import"./ArrowDown-00ad04a7.js";import"./Checkbox-9a7e928d.js";import"./index-ed7b3e6e.js";import"./ChevronRight-ab7b1b96.js";import"./Tooltip-dfa056a2.js";import"./Select-f7ce401c.js";import"./Tag-b4c59312.js";import"./Pagination-929c7ebe.js";import"./Forward-8c76bb04.js";import"./prop-0f12dfb2.js";import"./ExternalLink-4655a142.js";const re={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},se=_("path",{d:"M104 224H24c-13.255 0-24 10.745-24 24v240c0 13.255 10.745 24 24 24h80c13.255 0 24-10.745 24-24V248c0-13.255-10.745-24-24-24zM64 472c-13.255 0-24-10.745-24-24s10.745-24 24-24s24 10.745 24 24s-10.745 24-24 24zM384 81.452c0 42.416-25.97 66.208-33.277 94.548h101.723c33.397 0 59.397 27.746 59.553 58.098c.084 17.938-7.546 37.249-19.439 49.197l-.11.11c9.836 23.337 8.237 56.037-9.308 79.469c8.681 25.895-.069 57.704-16.382 74.757c4.298 17.598 2.244 32.575-6.148 44.632C440.202 511.587 389.616 512 346.839 512l-2.845-.001c-48.287-.017-87.806-17.598-119.56-31.725c-15.957-7.099-36.821-15.887-52.651-16.178c-6.54-.12-11.783-5.457-11.783-11.998v-213.77c0-3.2 1.282-6.271 3.558-8.521c39.614-39.144 56.648-80.587 89.117-113.111c14.804-14.832 20.188-37.236 25.393-58.902C282.515 39.293 291.817 0 312 0c24 0 72 8 72 81.452z",fill:"currentColor"},null,-1),ne=[se];var oe=w({name:"ThumbsUp",render:function(o,c){return D(),I("svg",re,ne)}});const De=w({name:"PostList",setup(){const{loading:k,checkedRowKeys:o,data:c,pager:g,sortProps:l,fetchDataFn:b}=ee((s,r)=>async(e=P.query.page||1,f=20)=>{const a=await u.api.posts.get({params:{page:e,size:f,select:"title _id id created modified slug categoryId copyright tags count pin",...l.sortBy?{sortBy:l.sortBy,sortOrder:l.sortOrder}:{}}});s.value=a.data,r.value=a.pagination}),y=F(),P=R(),n=b;E(()=>P.query.page,async s=>{await n(s)});const i=M(j);A(async()=>{await n(),await i.fetch()});const B=w({setup(){const s=L(()=>i.data.value?.map(e=>({label:e.name,value:e.id}))||[]),r=V([{type:"selection",options:["none","all"]},{title:"\u6807\u9898",sortOrder:!1,sorter:"default",key:"title",width:200,ellipsis:!0,render(e){return t("div",{class:"flex items-center space-x-2"},[e.pin&&t(z,null,{trigger(){return t(H,{class:"text-yellow-200"},{default:()=>[t(U,null,null)]})},default(){return e.pin?t("span",null,[m("\u7F6E\u9876\u4E8E")," ",S(e.pin,"yyyy\u5E74M\u6708d\u65E5 HH:mm:ss")]):null}}),t(W,{id:e.id,title:e.title,inPageTo:`/posts/edit?id=${e.id}`,externalLinkTo:`/posts/${e.category.slug}/${e.slug}`},null)])}},{title:"\u5206\u7C7B",sortOrder:!1,sorter:"default",key:"category",width:80,ellipsis:!0,filterOptions:s,filter:!0,render(e){return i.map.value?t(Z,{returnToConfrim:!1,initialValue:i.map.value.get(e.categoryId)?.name??"",onSubmit:async a=>{await u.api.posts(e.id).patch({data:{categoryId:a}}),y.success("\u4FEE\u6539\u6210\u529F~!"),c.value.find(h=>h.id===e.id).categoryId=a},type:"select",options:i.data.value?.map(a=>({label:a.name,value:a.id,key:a.id}))||[]},null):""}},{title:"\u6807\u7B7E",key:"tags",width:100,ellipsis:!0,render(e){return e.tags?.join("\uFF0C")}},{title:()=>t(x,null,{default:()=>[t($,null,null)]}),key:"count.read",width:50,render(e){return e.count?.read||0}},{title:()=>t(x,null,{default:()=>[t(oe,null,null)]}),width:50,key:"count.like",render(e){return e.count?.like||0}},{title:"\u521B\u5EFA\u4E8E",width:100,key:"created",sortOrder:"descend",sorter:"default",render(e){return t(T,{time:e.created},null)}},{title:"\u4FEE\u6539\u4E8E",key:"modified",sorter:"default",sortOrder:!1,width:100,render(e){return t(T,{time:e.modified},null)}},{title:"\u64CD\u4F5C",fixed:"right",width:60,key:"id",render(e){return t(K,null,{default:()=>[t(ae,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await u.api.posts(e.id).delete(),y.success("\u5220\u9664\u6210\u529F"),await n(g.value.currentPage)}},{trigger:()=>t(q,{text:!0,type:"error",size:"tiny"},{default:()=>[m("\u79FB\u9664")]}),default:()=>t("span",{class:"max-w-48"},[m("\u786E\u5B9A\u8981\u5220\u9664 "),e.title,m(" ?")])})]})}}]);return()=>t(Y,{loading:k.value,columns:r,data:c,nTableProps:{onUpdateFilters:async(e,f)=>{if(!!e&&e.category&&Array.isArray(e.category)){if(!e.category.length){await n();return}const h=e.category.join(","),{entries:C}=await u.api.categories.get({params:{ids:h}}),O=Object.values(C).reduce((v,d)=>{const N=d.children?.map(p=>(Object.defineProperty(p,"categoryId",{value:d.id,enumerable:!0}),Object.defineProperty(p,"category",{get(){return p},enumerable:!1}),p));return[...v,...N]},[]).sort((v,d)=>+new Date(v.created)-+new Date(d.created));c.value=O,g.value={currentPage:1,total:1,size:0,hasNextPage:!1,hasPrevPage:!1,totalPage:1}}}},onFetchData:n,pager:g,onUpdateCheckedRowKeys:e=>{o.value=e},onUpdateSorter:async e=>{l.sortBy=e.sortBy,l.sortOrder=e.sortOrder}},null)}});return()=>t(Q,null,{actions:()=>t(G,null,[t(X,{checkedRowKeys:o.value,onDelete:async()=>{const s=await Promise.allSettled(o.value.map(r=>u.api.posts(r).delete()));for(const r of s)r.status==="rejected"&&y.success(`\u5220\u9664\u5931\u8D25\uFF0C${r.reason.message}`);o.value.length=0,n()}},null),t(te,{to:"/posts/edit",icon:t(J,null,null)},null)]),default:()=>t(B,null,null)})}});export{De as ManagePostListView};
