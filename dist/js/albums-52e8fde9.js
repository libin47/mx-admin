import{f as S,k as C,H as f,u as w,m as A,a as e,F as T,df as F,C as z,p as B,w as R,bP as D,cz as E,b as i,R as g,d as N,N as m,bR as I,L as h}from"./index-23675994.js";import{H as M}from"./rounded-button-7c59c61c.js";import{t as H}from"./index-74bfa454.js";import{T as L}from"./title-link-49df6145.js";import{u as P}from"./album-c7272296.js";import{a as V}from"./DataTable-3e4b58c6.js";import{N as q}from"./Popconfirm-99c542b2.js";import{N as U}from"./Form-803b561c.js";import{N as y}from"./FormItemRow-cfcfe83a.js";import"./iframe-preview-f71c7c4f.js";import"./ExternalLink-5cb14526.js";import"./ArrowDown-cc3d70f2.js";import"./Checkbox-54c2c25e.js";import"./index-c6a5c591.js";import"./ChevronRight-39fd66c6.js";import"./Tooltip-fa6ed610.js";import"./Select-96fa6219.js";import"./Tag-cf0fa0d0.js";import"./Pagination-d0fd04b8.js";import"./Forward-4d60d441.js";import"./prop-0f12dfb2.js";import"./FormItem-f55390e0.js";const me=S(u=>{const t=C(P),s=f(!0),o=t.fetch,a=w();A(async()=>{s.value=!0,await o(),s.value=!1});const n=f(!1),v=()=>({name:"",slug:""}),d=f(v());return()=>e(z,{actionsElement:e(T,null,[e(M,{variant:"success",icon:e(F,null,null),onClick:()=>{n.value=!0,d.value=v()}},null)])},{default:()=>[e(E,{prefix:"bar"},{default:()=>[i("\u5206\u7C7B")]}),e(x,{show:n,onSubmit:async l=>{const{name:c,slug:b}=l,p=typeof n.value=="string"?n.value:null;if(p){await g.api.albums(p).put({data:{name:c,slug:b,type:0}}),a.success("\u4FEE\u6539\u6210\u529F");const r=t.data.value.findIndex(k=>k.id==p);t.data.value[r]={...t.data.value[r],...l}}else{const r=await g.api.albums.post({data:{name:c,slug:b}});a.success("\u521B\u5EFA\u6210\u529F"),t.data.value.push(r.data)}},initialState:d.value},null),e(V,{rowClassName:()=>H,size:"small",bordered:!1,data:t.data.value||[],remote:!0,loading:s.value,columns:[{title:"\u540D\u79F0",key:"name",render(l){return l.name,e(L,{title:l.name,inPageTo:"/images/photos?id="+l.id},null)}},{title:"\u6570",key:"count"},{title:"\u8DEF\u5F84",key:"slug",width:300},{width:300,title:"\u64CD\u4F5C",fixed:"right",key:"id",render(l){return e(N,{size:12},{default:()=>[e(m,{size:"tiny",text:!0,type:"primary",onClick:c=>{d.value={name:l.name,slug:l.slug},n.value=l.id}},{default:()=>[i("\u7F16\u8F91")]}),e(q,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await g.api.albums(l.id).delete(),a.success("\u5220\u9664\u6210\u529F"),await t.fetch(!0)}},{trigger:()=>e(m,{text:!0,type:"error",size:"tiny"},{default:()=>[i("\u79FB\u9664")]}),default:()=>e("span",{style:{maxWidth:"12rem"}},[i("\u786E\u5B9A\u8981\u5220\u9664 "),l.title,i(" ?")])})]})}}]},null)]})}),x=S(u=>{const t=B(u.initialState??{name:"",slug:""});R(()=>u.initialState,a=>{a&&(t.name=a.name,t.slug=a.slug)});const s=w(),o=()=>{if(!t.name||!t.slug){s.error("\u540D\u5B57 \u548C \u8DEF\u5F84 \u4E0D\u80FD\u4E3A\u7A7A");return}u.onSubmit(t),u.show.value=!1};return()=>e(D,{show:!!u.show.value,onUpdateShow:a=>{u.show.value=a}},{default:()=>e(I,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:u.initialState?"\u7F16\u8F91":"\u65B0\u5EFA"},{default:()=>[e(U,{onSubmit:o,rules:{name:{required:!0,trigger:["input","blur"]},slug:{required:!0,trigger:["input","blur"]}}},{default:()=>[e(y,{path:"name",label:"\u540D\u5B57"},{default:()=>[e(h,{placeholder:"",onInput:a=>{t.name=a},value:t.name},null)]}),e(y,{path:"slug",label:"\u8DEF\u5F84"},{default:()=>[e(h,{placeholder:"",onInput:a=>{t.slug=a},value:t.slug},null)]}),e("div",{class:"text-center"},[e(N,{size:12,align:"center",inline:!0},{default:()=>[e(m,{type:"success",onClick:o,round:!0},{default:()=>[i("\u786E\u5B9A")]}),e(m,{onClick:()=>u.show.value=!1,round:!0},{default:()=>[i("\u53D6\u6D88")]})]})])]})]})})});x.props=["initialState","onSubmit","show"];export{me as ManageAlbumsListView};
