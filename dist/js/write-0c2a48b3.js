import{H as V}from"./rounded-button-7c59c61c.js";import{P as k,T as E}from"./parse-content-d6e6f009.js";import{E as T}from"./toggle-cebab316.js";import{f as h,j as $,k as M,l as B,m as v,p as H,n as w,R as d,H as i,u as O,E as A,a as t,F as I,br as W,I as q,C as z,bs as D,bt as F,W as L,L as j}from"./index-23675994.js";import{S as Y,M as _}from"./material-input-94a8968d.js";import{U as G}from"./underline-input-21e7236d.js";import{i as J}from"./isString-f2f8848c.js";import{N as K}from"./DynamicTags-17b29ece.js";import{N as r}from"./FormItem-f55390e0.js";import{N}from"./Select-96fa6219.js";import{N as R}from"./Switch-ff645ce9.js";import{N as Q}from"./InputNumber-4cc9bfb6.js";import"./CollapseItem-2f9f4c71.js";import"./ChevronRight-39fd66c6.js";import"./Form-803b561c.js";import"./ButtonGroup-c2307137.js";import"./use-async-monaco-7e7ec60e.js";import"./index-3f3ba5dd.js";import"./editor.main-2ae2afed.js";import"./use-save-confirm-6f0bbfea.js";import"./DynamicInput-dd054825.js";import"./Add-17a04330.js";import"./ArrowDown-cc3d70f2.js";import"./js-yaml-fae8e8ce.js";import"./use-react-b6888cd4.js";import"./throttle-d4ef57ab.js";import"./Tag-cf0fa0d0.js";import"./prop-0f12dfb2.js";import"./index-c6a5c591.js";const Pe=h(()=>{const S=$(),u=M(B);v(async()=>{await u.fetch()});const C=()=>({categoryId:u.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],summary:"",allowComment:!0,id:void 0,images:[],meta:void 0,pin:!1,pinOrder:1}),x=e=>{const l=D(a),n=Object.keys(l);for(const o in e)n.includes(o)&&(a[o]=e[o])},a=H(C()),s=w(()=>S.query.id),c=w(()=>u.get(a.categoryId)||u.data?.value?.[0]||{});v(async()=>{const e=s.value;if(e&&typeof e=="string"){const l=await d.api.posts(e).get();x(l.data)}});const g=i(!1),y=O(),P=A(),U=async()=>{const e={...a,categoryId:c.value.id,summary:a.summary&&a.summary.trim()!=""?a.summary.trim():null};if(s.value){if(!J(s.value))return;const l=s.value;await d.api.posts(l).put({data:e}),y.success("\u4FEE\u6539\u6210\u529F")}else await d.api.posts.post({data:e}),y.success("\u53D1\u5E03\u6210\u529F");P.push({name:F.ViewPost,hash:"|publish"})};return()=>t(z,{title:s.value?"\u4FEE\u6539\u6587\u7AE0":"\u64B0\u5199\u65B0\u6587\u7AE0",actionsElement:t(I,null,[t(k,{data:a,onHandleYamlParsedMeta:e=>{const{title:l,slug:n,...o}=e;a.title=l??a.title,a.slug=n??a.slug,a.meta={...o}}},null),t(V,{icon:t(W,null,null),onClick:U},null)]),footerButtonElement:t(I,null,[t("button",{onClick:()=>{g.value=!0}},[t(q,null,{default:()=>[t(Y,null,null)]})])])},{default:()=>[t(_,{class:"mt-3 relative z-10",label:"\u60F3\u60F3\u53D6\u4E2A\u4EC0\u4E48\u6807\u9898\u597D\u5462~",value:a.title,onChange:e=>{a.title=e}},null),t("div",{class:"text-gray-500 py-3"},[t("label",{class:"prefix"},[`${L}/${c.value.slug}/`]),t(G,{class:"ml-2",value:a.slug,onChange:e=>{a.slug=e}},null)]),t(T,{loading:!!(s.value&&typeof a.id>"u"),onChange:e=>{a.text=e},text:a.text},null),t(E,{show:g.value,onUpdateShow:e=>{g.value=e},data:a},{default:()=>[t(r,{label:"\u5206\u7C7B",required:!0,path:"category"},{default:()=>[t(N,{placeholder:"\u8BF7\u9009\u62E9",value:c.value.id,onUpdateValue:e=>{a.categoryId=e},options:u.data.value?.map(e=>({label:e.name,value:e.id,key:e.id}))||[]},null)]}),t(r,{label:"\u6807\u7B7E"},{default:()=>[t(K,{value:a.tags,onUpdateValue:e=>{a.tags.length=0,a.tags.push(...e)}},{input({submit:e}){const l=h({setup(){const n=i([]),o=i(!1),b=i(""),f=i();return v(async()=>{o.value=!0,f.value&&f.value.$el.querySelector("input").focus();const{data:m}=await d.api.categories.get({params:{type:"Tag"}});n.value=m.map(p=>({label:`${p.name} (${p.count})`,value:p.name,key:p.name})),o.value=!1}),()=>t(N,{ref:f,size:"small",value:b.value,clearable:!0,loading:o.value,filterable:!0,tag:!0,options:n.value,onUpdateValue:m=>{b.value=m,e(m)}},null)}});return t(l,null,null)}})]}),t(r,{label:"\u6982\u8981"},{default:()=>[t(j,{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"\u6587\u7AE0\u6982\u8981",value:a.summary,onInput:e=>void(a.summary=e)},null)]}),t(r,{label:"\u7248\u6743\u6CE8\u660E",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(R,{value:a.copyright,onUpdateValue:e=>void(a.copyright=e)},null)]}),t(r,{label:"\u7F6E\u9876",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(R,{value:!!a.pin,onUpdateValue:e=>{a.pin=e,e||(a.pinOrder=1)}},null)]}),t(r,{label:"\u7F6E\u9876",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(Q,{disabled:!a.pin,value:a.pinOrder,onUpdateValue:e=>void(a.pinOrder=e||1)},null)]})]})]})});export{Pe as default};
