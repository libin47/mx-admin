import{f as v,o as k,h as C,i as Q,H as r,n as B,R as d,m as D,u as S,a as e,F as _,C as E,p as F,w as M,bQ as z,d as N,N as m,b as u,bS as V,L as y}from"./index-d885f019.js";import{H}from"./rounded-button-6475331c.js";import{t as I}from"./index-3458d647.js";import{a as T}from"./DataTable-191a93c9.js";import{N as R}from"./Popconfirm-9e91c519.js";import{N as P}from"./Form-1d9f54f3.js";import{N as x}from"./FormItemRow-2ad6d3f0.js";import"./ArrowDown-00ad04a7.js";import"./Checkbox-9a7e928d.js";import"./index-ed7b3e6e.js";import"./ChevronRight-ab7b1b96.js";import"./Tooltip-dfa056a2.js";import"./Select-f7ce401c.js";import"./Tag-b4c59312.js";import"./Pagination-929c7ebe.js";import"./Forward-8c76bb04.js";import"./prop-0f12dfb2.js";import"./FormItem-f234e47c.js";const L={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 448 512"},j=Q("path",{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z",fill:"currentColor"},null,-1),U=[j];var W=v({name:"Plus",render:function(t,n){return k(),C("svg",L,U)}});function G(){const a=r(),t=B(()=>new Map(a.value?.map(n=>[n.id,n]))||new Map);return{data:a,get(n){return t.value.get(n)},async fetch(n){if(!a.value||n){const o=await d.api.QA.get();return a.value=o.data,a.value}else return a.value}}}const de=v(a=>{const t=G(),n=r(!0),o=t.fetch;D(async()=>{n.value=!0,await o(),n.value=!1});const i=S(),p=()=>({question:"",answer:[]}),l=r(!1),b=r(p()),h=r(p());return()=>e(E,{actionsElement:e(_,null,[e(H,{icon:e(W,null,null),variant:"primary",onClick:()=>{b.value=p(),l.value=!0}},null)])},{default:()=>[e(q,{show:l,onSubmit:async s=>{const{question:w,answer:g}=s,f=typeof l.value=="string"?l.value:null;if(f){await d.api.QA(f).put({data:{question:w,answer:g}}),i.success("\u4FEE\u6539\u6210\u529F");const c=t.data.value.findIndex(A=>A.id==f);t.data.value[c]={...t.data.value[c],...s}}else{const c=await d.api.QA.post({data:{question:w,answer:g}});i.success("\u521B\u5EFA\u6210\u529F"),t.data.value.push(c.data)}},initialState:h.value},null),e(T,{rowClassName:()=>I,size:"small",bordered:!1,data:t.data.value||[],remote:!0,loading:n.value,columns:[{title:"\u95EE\u9898",key:"question"},{title:"\u56DE\u7B54",key:"answer",width:800},{width:300,title:"\u64CD\u4F5C",fixed:"right",key:"id",render(s){return e(N,{size:12},{default:()=>[e(m,{size:"tiny",text:!0,type:"primary",onClick:w=>{h.value={question:s.question,answer:s.answer},l.value=s.id}},{default:()=>[u("\u7F16\u8F91")]}),e(R,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await d.api.QA(s.id).delete(),i.success("\u5220\u9664\u6210\u529F"),await t.fetch(!0)}},{trigger:()=>e(m,{text:!0,type:"error",size:"tiny"},{default:()=>[u("\u79FB\u9664")]}),default:()=>e("span",{style:{maxWidth:"12rem"}},[u("\u786E\u5B9A\u8981\u5220\u9664 "),s.title,u(" ?")])})]})}}]},null)]})}),q=v(a=>{const t=F(a.initialState??{question:"",answer:[]});M(()=>a.initialState,i=>{i&&(t.question=i.question,t.answer=i.answer)});const n=S(),o=()=>{if(!t.question||!t.answer){n.error("\u95EE\u9898 \u548C \u7B54\u6848 \u4E0D\u80FD\u4E3A\u7A7A");return}a.onSubmit(t),a.show.value=!1};return()=>e(z,{show:!!a.show.value,onUpdateShow:i=>{a.show.value=i}},{default:()=>e(V,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:a.initialState?"\u7F16\u8F91":"\u65B0\u5EFA"},{default:()=>[e(P,{onSubmit:o,rules:{question:{required:!0,trigger:["input","blur"]},answer:{required:!0,trigger:["input","blur"]}}},{default:()=>[e(x,{path:"question",label:"\u95EE\u9898"},{default:()=>[e(y,{placeholder:"",onInput:i=>{t.question=i},value:t.question},null)]}),e(x,{path:"answer",label:"\u7B54\u6848"},{default:()=>[e(y,{placeholder:"",onInput:i=>{t.answer=i.split(",")},value:t.answer.join(",")},null)]}),e("div",{class:"text-center"},[e(N,{size:12,align:"center",inline:!0},{default:()=>[e(m,{type:"success",onClick:o,round:!0},{default:()=>[u("\u786E\u5B9A")]}),e(m,{onClick:()=>a.show.value=!1,round:!0},{default:()=>[u("\u53D6\u6D88")]})]})])]})]})})});q.props=["initialState","onSubmit","show"];export{G as QAStore,de as QAView};
