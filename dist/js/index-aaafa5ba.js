import{H as U}from"./rounded-button-72b1e886.js";import{f as S,j as te,E as se,H as y,u as le,w as L,cJ as re,a as t,F as ue,A as ne,dy as ie,C as oe,R as m,q as ce,m as de,S as he,bt as fe,bS as R,b as f,d as M,N as A,bP as ve,bR as me,L as E,dz as pe,bs as ge}from"./index-e5bed378.js";import{T as Ce}from"./index-3632c606.js";import{R as ye}from"./relative-time-aed3d5c9.js";import{u as Ne}from"./use-table-594cc760.js";import{N as I}from"./Avatar-aa4857c1.js";import{N as xe,a as F}from"./Tabs-40751cd4.js";import{N as P}from"./Badge-f6919198.js";import{N as Ae}from"./Popconfirm-3d255664.js";import{N as be}from"./Form-73b4dc50.js";import{N as C}from"./FormItem-24528282.js";import{N as B}from"./Select-239870b5.js";import"./DataTable-198093e7.js";import"./ArrowDown-69f332f3.js";import"./Checkbox-b3af8ed2.js";import"./index-fad78fc5.js";import"./ChevronRight-dc5aeee4.js";import"./Tooltip-b2a8da96.js";import"./Pagination-fe4f450a.js";import"./Forward-6700ba98.js";import"./prop-0f12dfb2.js";import"./Tag-51d685b8.js";import"./Add-e315e65f.js";import"./throttle-a5ae19ab.js";var K={exports:{}};const we=/[\p{Lu}]/u,Ee=/[\p{Ll}]/u,O=/^[\p{Lu}](?![\p{Lu}])/gu,W=/([\p{Alpha}\p{N}_]|$)/u,Y=/[_.\- ]+/,Fe=new RegExp("^"+Y.source),T=new RegExp(Y.source+W.source,"gu"),q=new RegExp("\\d+"+W.source,"gu"),_e=(e,a,l)=>{let r=!1,d=!1,n=!1;for(let h=0;h<e.length;h++){const o=e[h];r&&we.test(o)?(e=e.slice(0,h)+"-"+e.slice(h),r=!1,n=d,d=!0,h++):d&&n&&Ee.test(o)?(e=e.slice(0,h-1)+"-"+e.slice(h-1),n=d,d=!1,r=!0):(r=a(o)===o&&l(o)!==o,n=d,d=l(o)===o&&a(o)!==o)}return e},Re=(e,a)=>(O.lastIndex=0,e.replace(O,l=>a(l))),Ie=(e,a)=>(T.lastIndex=0,q.lastIndex=0,e.replace(T,(l,r)=>a(r)).replace(q,l=>a(l))),X=(e,a)=>{if(!(typeof e=="string"||Array.isArray(e)))throw new TypeError("Expected the input to be `string | string[]`");if(a={pascalCase:!1,preserveConsecutiveUppercase:!1,...a},Array.isArray(e)?e=e.map(n=>n.trim()).filter(n=>n.length).join("-"):e=e.trim(),e.length===0)return"";const l=a.locale===!1?n=>n.toLowerCase():n=>n.toLocaleLowerCase(a.locale),r=a.locale===!1?n=>n.toUpperCase():n=>n.toLocaleUpperCase(a.locale);return e.length===1?a.pascalCase?r(e):l(e):(e!==l(e)&&(e=_e(e,l,r)),e=e.replace(Fe,""),a.preserveConsecutiveUppercase?e=Re(e,l):e=l(e),a.pascalCase&&(e=r(e.charAt(0))+e.slice(1)),Ie(e,r))};K.exports=X;K.exports.default=X;class Pe{constructor(a={}){if(!(a.maxSize&&a.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=a.maxSize,this.onEviction=a.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_set(a,l){if(this.cache.set(a,l),this._size++,this._size>=this.maxSize){if(this._size=0,typeof this.onEviction=="function")for(const[r,d]of this.oldCache.entries())this.onEviction(r,d);this.oldCache=this.cache,this.cache=new Map}}get(a){if(this.cache.has(a))return this.cache.get(a);if(this.oldCache.has(a)){const l=this.oldCache.get(a);return this.oldCache.delete(a),this._set(a,l),l}}set(a,l){return this.cache.has(a)?this.cache.set(a,l):this._set(a,l),this}has(a){return this.cache.has(a)||this.oldCache.has(a)}peek(a){if(this.cache.has(a))return this.cache.get(a);if(this.oldCache.has(a))return this.oldCache.get(a)}delete(a){const l=this.cache.delete(a);return l&&this._size--,this.oldCache.delete(a)||l}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}*keys(){for(const[a]of this)yield a}*values(){for(const[,a]of this)yield a}*[Symbol.iterator](){for(const a of this.cache)yield a;for(const a of this.oldCache){const[l]=a;this.cache.has(l)||(yield a)}}get size(){let a=0;for(const l of this.oldCache.keys())this.cache.has(l)||a++;return Math.min(this._size+a,this.maxSize)}}var Se=Pe;const ze=Se;new ze({maxSize:1e5});var j;(function(e){e[e.Category=0]="Category",e[e.Tag=1]="Tag"})(j||(j={}));var V;(function(e){e[e.Post=0]="Post",e[e.Note=1]="Note"})(V||(V={}));var H;(function(e){e.Page="Page",e.Post="Post",e.Note="Note"})(H||(H={}));var J;(function(e){e[e.Unread=0]="Unread",e[e.Read=1]="Read",e[e.Junk=2]="Junk"})(J||(J={}));var b;(function(e){e[e.Friend=0]="Friend",e[e.Collection=1]="Collection"})(b||(b={}));var c;(function(e){e[e.Pass=0]="Pass",e[e.Audit=1]="Audit",e[e.Outdate=2]="Outdate",e[e.Banned=3]="Banned"})(c||(c={}));var $;(function(e){e.md="md",e.html="html",e.frame="frame"})($||($={}));var G;(function(e){e.JSON="json",e.Function="function",e.Text="text",e.YAML="yaml"})(G||(G={}));const ke={Audit:"\u5F85\u5BA1\u6838",Pass:"\u901A\u8FC7",Outdate:"\u8FC7\u65F6",Banned:"\u5C4F\u853D"};function Q(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!he(e)}var ra=S({setup(){const e=te(),a=se(),l=y(e.query.state??c.Pass),{data:r,checkedRowKeys:d,fetchDataFn:n,pager:h,loading:o}=Ne((s,i)=>async(v=e.query.page||1,x=50)=>{const _=e.query.state??c.Pass,D=await m.api.links.get({params:{page:v,size:x,state:_|0}});s.value=D.data,i.value=D.pagination}),N=le(),w=()=>({avatar:"",name:"",type:b.Friend,url:"",id:null,description:"",state:c.Pass}),p=y(!1),u=y(w());L(()=>e.query.state,async s=>{await n()}),L(()=>e.query.page,async s=>{await n()},{immediate:!0});const g=y({}),z=async()=>{const s=await m.api.links.state.get();g.value=s};re(()=>{z()});const ee=async()=>{const s=u.value.id;if(s){const i=await m.api.links(s).put({data:pe.omit(u.value,["id","created","hide"])}),v=r.value.findIndex(x=>x.id==s);i.state!=l.value?(r.value.splice(v,1),z()):r.value[v]={...r.value[v],...ge(u.value)}}else{const{data:i}=await m.api.links.post({data:{...u.value}});r.value.unshift(i)}N.success("\u64CD\u4F5C\u6210\u529F"),p.value=!1,u.value=w()},k=y(),ae=async()=>{const s=N.loading("\u68C0\u67E5\u4E2D",{duration:2e5});try{const i=await m.api.links.health.get({timeout:2e5});k.value=Object.entries(i).reduce((v,[x,_])=>({...v,[x.toLowerCase()]:_}),{}),N.success("\u68C0\u67E5\u5B8C\u6210")}catch(i){console.error(i)}finally{requestAnimationFrame(()=>{s.destroy()})}};return()=>t(oe,{actionsElement:t(ue,null,[t(U,{icon:t(ne,null,null),variant:"primary",onClick:()=>{u.value=w(),p.value=!0}},null),t(U,{icon:t(ie,null,null),variant:"info",onClick:ae,name:"\u68C0\u67E5\u53CB\u94FE\u53EF\u7528\u6027"},null)])},{default:()=>[t(xe,{class:"min-h-[30px]",size:"medium",value:l.value,onUpdateValue:s=>{l.value=s,a.replace({name:fe.Friend,query:{state:s}})}},{default:()=>[t(F,{name:c.Pass,tab:"\u670B\u53CB\u4EEC"},null),t(F,{name:c.Audit,tab:()=>t(P,{value:g.value.audit,processing:!0},{default:()=>[t(R,null,{default:()=>[f("\u5F85\u5BA1\u6838")]})]})},null),t(F,{name:c.Outdate,tab:()=>t(P,{value:g.value.outdate,type:"info"},{default:()=>[t(R,null,{default:()=>[f("\u8FC7\u65F6\u7684")]})]})},null),t(F,{name:c.Banned,tab:()=>t(P,{value:g.value.banned,type:"warning"},{default:()=>[t(R,null,{default:()=>[f("\u5C01\u7981\u7684")]})]})},null)]}),t(Ce,{loading:o.value,data:r,nTableProps:{maxHeight:"calc(100vh - 22rem)"},columns:[{title:"\u5934\u50CF",key:"avatar",width:80,render(s){return t(Z,{name:s.name,avatar:s.avatar},null)}},{title:"\u540D\u79F0",key:"name",render(s){return t("a",{target:"_blank",href:s.url,rel:"noreferrer"},[s.name])}},{title:"\u63CF\u8FF0",key:"description",width:250,ellipsis:{lineClamp:2,tooltip:!0}},{title:"\u7F51\u5740",key:"url",render(s){const i=k.value?.[s.id];return t(De,{url:s.url,errorMessage:i?.message,status:i?.status},null)}},{title:"\u7C7B\u578B",key:"type",width:80,render(s){return["\u670B\u53CB","\u6536\u85CF"][s.type|0]}},{title:"\u5BF9\u65B9\u90AE\u7BB1",key:"email",render(s){return t("a",{href:`mailto:${s.email}`},[s.email])}},{title:"\u7ED3\u8BC6\u65F6\u95F4",key:"created",width:80,render(s){return t(ye,{time:s.created},null)}},{width:150,title:"\u64CD\u4F5C",fixed:"right",key:"action",render(s){return t(M,{wrap:!1},{default:()=>[s.state==c.Audit&&t(A,{text:!0,size:"tiny",type:"success",onClick:async()=>{await m.api.links.audit(s.id).patch(),N.success(`\u901A\u8FC7\u4E86\u6765\u81EA${s.name}\u7684\u53CB\u94FE\u9080\u8BF7`);const i=r.value.findIndex(v=>v.id==s.id);r.value.splice(i,1),g.value.audit--}},{default:()=>[f("\u901A\u8FC7")]}),t(A,{text:!0,size:"tiny",type:"info",onClick:i=>{p.value=!0,u.value={...s}}},{default:()=>[f("\u7F16\u8F91")]}),t(Ae,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await m.api.links(s.id).delete(),N.success("\u5220\u9664\u6210\u529F"),await n(h.value.currentPage),s.state==c.Audit&&g.value.audit--}},{trigger:()=>t(A,{text:!0,type:"error",size:"tiny"},{default:()=>[f("\u79FB\u9664")]}),default:()=>t("span",{class:"max-w-48"},[f("\u786E\u5B9A\u8981\u5220\u9664\u53CB\u94FE "),s.name,f(" ?")])})]})}}],onFetchData:n,pager:h},null),t(ve,{transformOrigin:"center",show:p.value,onUpdateShow:s=>void(p.value=s)},{default:()=>[t(me,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:u.value.id?`\u7F16\u8F91: ${u.value.name}`:"\u65B0\u589E"},{default:()=>[t(be,null,{default:()=>[t(C,{label:"\u540D\u5B57",required:!0},{default:()=>[t(E,{autofocus:!0,value:u.value.name,onInput:s=>void(u.value.name=s)},null)]}),t(C,{label:"\u5934\u50CF"},{default:()=>[t(E,{autofocus:!0,value:u.value.avatar,onInput:s=>void(u.value.avatar=s)},null)]}),t(C,{label:"\u7F51\u5740",required:!0},{default:()=>[t(E,{autofocus:!0,value:u.value.url,onInput:s=>void(u.value.url=s)},null)]}),t(C,{label:"\u63CF\u8FF0"},{default:()=>[t(E,{autofocus:!0,value:u.value.description,onInput:s=>void(u.value.description=s)},null)]}),t(C,{label:"\u7C7B\u578B"},{default:()=>[t(B,{placeholder:"\u9009\u62E9\u7C7B\u578B",options:[{label:"\u670B\u53CB",value:b.Friend},{label:"\u6536\u85CF",value:b.Collection}],value:u.value.type,onUpdateValue:s=>void(u.value.type=s|0)},null)]}),u.value.id&&t(C,{label:"\u72B6\u6001"},{default:()=>[t(B,{placeholder:"\u9009\u62E9\u72B6\u6001",options:Object.entries(ke).map(([s,i])=>({label:i,value:c[s]})),value:u.value.state,onUpdateValue:s=>void(u.value.state=s|0)},null)]})]}),t("div",{class:"text-right"},[t(M,{size:12,align:"center",inline:!0},{default:()=>[t(A,{type:"success",onClick:ee,round:!0},{default:()=>[f("\u786E\u5B9A")]}),t(A,{onClick:()=>{p.value=!1,u.value=w()},round:!0},{default:()=>[f("\u53D6\u6D88")]})]})])]})]})]})}});const De=S({props:{url:String,errorMessage:String,status:[String,Number]},setup(e){return()=>t("div",{class:"flex space-x-2 items-center"},[t("a",{target:"_blank",href:e.url,rel:"noreferrer"},[e.url]),typeof e.status<"u"&&(e.errorMessage?t(ce,null,{trigger(){return t("div",{class:"h-2 w-2 bg-red-400 rounded-full"},null)},default(){return e.errorMessage}}):t("div",{class:"h-2 w-2 bg-green-300 rounded-full"},null))])}}),Z=S(e=>{const a=y(!e.avatar);return de(()=>{if(e.avatar){const l=new Image;l.src=e.avatar,l.onload=r=>{a.value=!0}}}),()=>{let l,r;return e.avatar?a.value?t(I,{src:e.avatar,round:!0},null):t(I,{round:!0},Q(l=e.name.charAt(0))?l:{default:()=>[l]}):t(I,{round:!0},Q(r=e.name.charAt(0))?r:{default:()=>[r]})}});Z.props=["avatar","name"];export{ra as default};
