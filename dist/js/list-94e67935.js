import{ce as L,bk as U,dw as $,b3 as D,T as E,a4 as z,f as j,aN as K,X as q,V as H,a7 as x,n as T,w as A,b5 as R,Z as G,Y as Z,$ as M,a3 as W,al as X,aG as Y,az as J,ac as P,H as Q,a8 as ee,K as B,a9 as te,aa as F,q as ae,ab as _,R as N,p as se,u as ne,j as oe,m as re,a as t,F as le,A as ie,bW as ue,d2 as ce,N as b,bZ as de,d as pe,b as y,t as fe,r as me,bu as he,s as ve,dx as ge,S as be,C as ye}from"./index-d885f019.js";import{D as we}from"./delete-confirm-a760e989.js";import{R as Pe}from"./relative-time-610c2d0d.js";import{u as Ne}from"./use-table-f4b6379e.js";import{H as Me}from"./rounded-button-6475331c.js";import{c as je,a as xe}from"./Checkbox-9a7e928d.js";import{b as Ce,c as Se}from"./Select-f7ce401c.js";import{N as Te,a as Re}from"./ListItem-1c574609.js";import{N as _e}from"./Pagination-929c7ebe.js";import{N as Oe}from"./ButtonGroup-e00e1490.js";import{N as O}from"./Avatar-2ed00750.js";import"./Tag-b4c59312.js";import"./Forward-8c76bb04.js";import"./prop-0f12dfb2.js";function ke(e){const{boxShadow2:s}=e;return{menuBoxShadow:s}}const Ae=L({name:"Popselect",common:U,peers:{Popover:$,InternalSelectMenu:D},self:ke});var V=Ae;const I=E("n-popselect");var Be=z("popselect-menu",`
 box-shadow: var(--n-menu-box-shadow);
`);const C={multiple:Boolean,value:{type:[String,Number,Array],default:null},cancelable:Boolean,options:{type:Array,default:()=>[]},size:{type:String,default:"medium"},scrollable:Boolean,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onMouseenter:Function,onMouseleave:Function,renderLabel:Function,onChange:[Function,Array]},k=W(C);var Fe=j({name:"PopselectPanel",props:C,setup(e){K(()=>{e.onChange!==void 0&&X("popselect","`on-change` is deprecated, please use `on-update:value` instead.")});const s=q(I),{mergedClsPrefixRef:o,inlineThemeDisabled:u}=H(e),m=x("Popselect","-pop-select",Be,V,s.props,o),c=T(()=>Y(e.options,Se("value","children")));function l(n,p){const{onUpdateValue:d,"onUpdate:value":v,onChange:g}=e;d&&P(d,n,p),v&&P(v,n,p),g&&P(g,n,p)}function i(n){a(n.key)}function r(n){J(n,"action")||n.preventDefault()}function a(n){const{value:{getNode:p}}=c;if(e.multiple)if(Array.isArray(e.value)){const d=[],v=[];let g=!0;e.value.forEach(S=>{if(S===n){g=!1;return}const w=p(S);w&&(d.push(w.key),v.push(w.rawNode))}),g&&(d.push(n),v.push(p(n).rawNode)),l(d,v)}else{const d=p(n);d&&l([n],[d.rawNode])}else if(e.value===n&&e.cancelable)l(null,null);else{const d=p(n);d&&l(n,d.rawNode),s.setShow(!1)}R(()=>{s.syncPosition()})}A(G(e,"options"),()=>{R(()=>{s.syncPosition()})});const f=T(()=>{const{self:{menuBoxShadow:n}}=m.value;return{"--n-menu-box-shadow":n}}),h=u?Z("select",void 0,f,s.props):void 0;return{mergedTheme:s.mergedThemeRef,mergedClsPrefix:o,treeMate:c,handleToggle:i,handleMenuMousedown:r,cssVars:u?void 0:f,themeClass:h?.themeClass,onRender:h?.onRender}},render(){var e;return(e=this.onRender)===null||e===void 0||e.call(this),M(Ce,{clsPrefix:this.mergedClsPrefix,focusable:!0,class:[`${this.mergedClsPrefix}-popselect-menu`,this.themeClass],style:this.cssVars,theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,multiple:this.multiple,treeMate:this.treeMate,size:this.size,value:this.value,virtualScroll:!1,scrollable:this.scrollable,renderLabel:this.renderLabel,onToggle:this.handleToggle,onMouseenter:this.onMouseenter,onMouseleave:this.onMouseenter,onMousedown:this.handleMenuMousedown},{action:()=>{var s,o;return((o=(s=this.$slots).action)===null||o===void 0?void 0:o.call(s))||[]},empty:()=>{var s,o;return((o=(s=this.$slots).empty)===null||o===void 0?void 0:o.call(s))||[]}})}});const Ve=Object.assign(Object.assign(Object.assign(Object.assign({},x.props),F(_,["showArrow","arrow"])),{placement:Object.assign(Object.assign({},_.placement),{default:"bottom"}),trigger:{type:String,default:"hover"}}),C);var Ie=j({name:"Popselect",props:Ve,__popover__:!0,setup(e){const s=x("Popselect","-popselect",void 0,V,e),o=Q(null);function u(){var l;(l=o.value)===null||l===void 0||l.syncPosition()}function m(l){var i;(i=o.value)===null||i===void 0||i.setShow(l)}return ee(I,{props:e,mergedThemeRef:s,syncPosition:u,setShow:m}),Object.assign(Object.assign({},{syncPosition:u,setShow:m}),{popoverInstRef:o,mergedTheme:s})},render(){const{mergedTheme:e}=this,s={theme:e.peers.Popover,themeOverrides:e.peerOverrides.Popover,builtinThemeOverrides:{padding:"0"},ref:"popoverInstRef",internalRenderBody:(o,u,m,c,l)=>M(Fe,Object.assign({},B(this.$attrs,{class:o,style:m}),te(this.$props,k),{ref:je(u),onMouseenter:c,onMouseleave:l}),{action:()=>{var i,r;return(r=(i=this.$slots).action)===null||r===void 0?void 0:r.call(i)},empty:()=>{var i,r;return(r=(i=this.$slots).empty)===null||r===void 0?void 0:r.call(i)}})};return M(ae,Object.assign({},F(this.$props,k),s),{trigger:()=>{var o,u;return(u=(o=this.$slots).default)===null||u===void 0?void 0:u.call(o)}})}});function Le(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!be(e)}const Qe=j({setup(){const{data:e,pager:s,sortProps:o,fetchDataFn:u,loading:m}=Ne((a,f)=>async(h=i.query.page||1,n=30)=>{const p=await N.api.projects.get({params:{page:h,size:n}});a.value=p.data,f.value=p.pagination}),c=se(new Set),l=ne(),i=oe(),r=u;return A(()=>i.query.page,async a=>{await r(a)}),re(async()=>{await r()}),()=>t(ye,null,{actions:()=>t(le,null,[t(we,{checkedRowKeys:c,onDelete:async()=>{await Promise.all(Array.from(c.values()).map(a=>N.api.projects(a).delete())),c.clear(),r()}},null),t(Me,{to:"/projects/edit",icon:t(ie,null,null)},null)]),default:()=>t(ue,{show:m.value},{default:()=>[t(Te,{bordered:!1,class:"min-h-[300px] bg-transparent"},{footer(){return t("div",{class:"flex justify-end"},[t(_e,{itemCount:s.value.total,pageCount:s.value.totalPage,page:s.value.currentPage,pageSize:s.value.size,onUpdatePage:a=>{r(a)}},null)])},default(){return e.value.map(a=>t(Re,{key:a.id},{prefix(){return t(xe,{class:"mt-4",checked:c.has(a.id),onUpdateChecked:f=>{f?c.add(a.id):c.delete(a.id)}},null)},default(){return t(ce,{description:a.description},{header(){return t("div",null,[t(b,B({ghost:!0,type:"primary",text:!0,class:"!font-medium"},a.projectUrl?{tag:"a",href:a.projectUrl,target:"_blank"}:{}),{default:()=>[a.name]})])},footer(){return t(de,null,{default:()=>[t(pe,{class:"pl-[3.6rem] text-[var(--clear-color-pressed)] text-sm"},{default:()=>[t("span",null,[y("\u521B\u5EFA\u4E8E "),fe(a.created)]),a.modified&&t("span",null,[y("\u66F4\u65B0\u4E8E")," ",t(Pe,{time:a.modified},null)])]})]})},"header-extra":function(){return t(Oe,null,{default:()=>[t(b,{onClick:()=>{me.push({name:he.EditProject,query:{id:a.id}})}},{default:()=>[y("\u7F16\u8F91")]}),t(Ie,{class:"!p-0",options:[{value:"del",label:"",render(){return t(b,{type:"error",bordered:!1,onClick:async()=>{await N.api.projects(a.id).delete(),l.success("\u5220\u9664\u6210\u529F"),await r(s.value.currentPage)}},{default:()=>[y("\u5220\u9664")]})}}]},{default:()=>[t(b,{class:"!px-2"},{default:()=>[t(ve,null,{default:()=>[t(ge,null,null)]})]})]})]})},avatar(){let f;return a.avatar?t(O,{class:"align-center",circle:!0,src:a.avatar,size:"large"},null):t(O,{circle:!0,size:"large",class:"align-center"},Le(f=a.name[0].toUpperCase())?f:{default:()=>[f]})}})}}))}})]})})}});export{Qe as default};
